# 5.2 專案特定上下文

## 💡 概念說明

專案特定上下文是指在 `CLAUDE.md` 中提供關於專案的背景資訊、業務邏輯和特殊需求,讓 AI 更深入理解您的專案。

---

## 🎯 為什麼需要專案上下文

### 1. 提升 AI 理解深度
- 了解業務邏輯
- 理解特殊名詞
- 掌握專案限制
- 知道歷史決策原因

### 2. 產生更準確的程式碼
- 符合業務需求
- 遵循專案慣例
- 避免不適用的建議
- 減少來回溝通

---

## 📋 專案上下文要素

### 1. 業務領域說明

```markdown
## 🏢 業務領域

### 專案類型
這是一個**線上教育平台**,提供課程管理、學員學習追蹤和證書發放功能。

### 核心概念
- **課程 (Course)**: 包含多個章節的學習內容
- **章節 (Chapter)**: 課程的子單元,包含影片、測驗等
- **學員 (Student)**: 註冊用戶,可報名課程
- **講師 (Instructor)**: 建立和管理課程的用戶
- **進度 (Progress)**: 學員完成課程的百分比

### 業務規則
1. 學員必須完成所有章節才能獲得證書
2. 課程有發布/草稿兩種狀態
3. 只有發布的課程對學員可見
4. 講師只能編輯自己的課程
```

### 2. 特殊術語對照

```markdown
## 📚 術語表

| 專案術語 | 一般術語 | 說明 |
|:--------|:--------|:-----|
| Enrollment | 報名/註冊 | 學員報名課程的動作 |
| Completion | 完課 | 完成所有章節並通過測驗 |
| Certificate | 證書 | 完課後頒發的電子證書 |
| Lesson | 課時 | 章節內的單一學習單元 |
| Quiz | 測驗 | 章節結束的評量 |

### 使用範例
\`\`\`typescript
// ✅ 使用專案術語
interface Enrollment {
  studentId: string;
  courseId: string;
  enrolledAt: Date;
}

// ❌ 不要使用
interface CourseRegistration { ... }
\`\`\`
```

### 3. 架構決策記錄

```markdown
## 🏗️ 架構決策

### 為什麼使用 Zustand 而非 Redux?
**決策**: 使用 Zustand 作為狀態管理
**原因**:
- 專案規模中小型,不需要 Redux 複雜度
- Zustand API 簡潔,學習曲線低
- TypeScript 支援良好
- bundle size 較小

### 為什麼使用 Prisma?
**決策**: 使用 Prisma 作為 ORM
**原因**:
- 型別安全的資料庫查詢
- 自動產生 TypeScript 型別
- Migration 管理方便
- 查詢效能良好

### API 設計選擇
**決策**: RESTful API (不使用 GraphQL)
**原因**:
- 團隊更熟悉 REST
- 查詢需求相對簡單
- 避免過度工程
```

### 4. 歷史遺留說明

```markdown
## 📜 歷史脈絡

### Legacy 程式碼
`src/legacy/` 目錄包含舊版課程系統的程式碼

**處理原則**:
- 不要重構 legacy 程式碼
- 僅修復嚴重 bug
- 新功能在 `src/modules/` 開發
- 計畫在 v3.0 完全移除

### 第三方整合
**支付系統**: 原本使用 Stripe,已遷移至 TapPay
- `src/payment/stripe/` 為舊程式碼,保留作為參考
- 所有新的支付相關功能使用 TapPay

**影片串流**: 使用 Vimeo API
- Vimeo player ID 儲存在課程資料中
- 影片上傳透過 Vimeo 後台
- 播放進度追蹤使用 Vimeo SDK
```

---

## 🎨 完整範例

### 電商平台專案上下文

```markdown
## 🛒 專案上下文: 電商平台

### 業務模式
B2C 電商平台,主要販售 3C 產品和配件

### 核心流程
1. **商品瀏覽** → 2. **加入購物車** → 3. **結帳** → 4. **訂單處理** → 5. **出貨追蹤**

### 特殊業務規則

#### 購物車規則
- 同一商品最多加入 99 件
- 購物車 30 天後自動清空
- 缺貨商品自動從購物車移除

#### 訂單規則
- 訂單成立後 15 分鐘內未付款自動取消
- 貨到付款訂單需人工審核
- 超商取貨金額上限 5000 元

#### 庫存規則
- 使用**悲觀鎖定**避免超賣
- 預購商品不扣庫存
- 庫存 < 10 顯示「數量有限」
- 庫存 = 0 顯示「補貨中」

### 資料模型關係
\`\`\`
User (會員)
  └── Order (訂單) 1:N
        └── OrderItem (訂單項目) 1:N
              └── Product (商品) N:1

Product (商品)
  └── SKU (庫存單位) 1:N
        └── Stock (庫存) 1:1
\`\`\`

### 狀態機

#### 訂單狀態
\`\`\`
PENDING (待付款)
  → PAID (已付款)
    → PROCESSING (處理中)
      → SHIPPED (已出貨)
        → DELIVERED (已送達)
          → COMPLETED (完成)

任何狀態都可以 → CANCELLED (取消)
PAID 之後可以 → REFUNDED (退款)
\`\`\`

### 整合的第三方服務
- **金流**: TapPay (信用卡)、綠界 (超商代碼)
- **物流**: 黑貓宅急便 API、超商取貨 (7-11/全家)
- **簡訊**: 三竹簡訊服務 (訂單通知)
- **發票**: 綠界電子發票

### 效能要求
- 首頁載入時間 < 2 秒
- API 回應時間 < 500ms
- 支援同時 1000 人線上
- 結帳流程轉換率目標 > 60%
```

---

## 🔍 實用技巧

### 1. 使用圖表輔助說明

```markdown
## 權限架構
\`\`\`
超級管理員 (SuperAdmin)
  └── 所有權限

管理員 (Admin)
  ├── 商品管理
  ├── 訂單管理
  └── 會員管理

店長 (Manager)
  ├── 訂單查詢
  └── 庫存管理

客服 (Support)
  └── 訂單查詢 (唯讀)
\`\`\`
```

### 2. 提供實際範例

```markdown
## 商品編號規則

### 格式
`[類別代碼]-[年份]-[流水號]`

### 範例
- `PHN-2024-00001` - 手機類,2024年第1號
- `ACC-2024-00123` - 配件類,2024年第123號
- `LAP-2024-00456` - 筆電類,2024年第456號

### 程式碼範例
\`\`\`typescript
const generateProductCode = (category: string, year: number, sequence: number) => {
  const categoryCode = CATEGORY_CODES[category]; // 'PHN', 'ACC', 'LAP'
  const paddedSequence = String(sequence).padStart(5, '0');
  return \`\${categoryCode}-\${year}-\${paddedSequence}\`;
};
\`\`\`
```

### 3. 說明特殊情境處理

```markdown
## 特殊情境處理

### 訂單取消
**情境**: 使用者在已付款後要求取消訂單

**處理流程**:
1. 檢查訂單狀態 (只有 PAID 狀態可取消)
2. 呼叫金流 API 退款
3. 恢復商品庫存
4. 更新訂單狀態為 CANCELLED
5. 發送取消通知簡訊

**注意事項**:
- 退款需 3-7 個工作天
- 信用卡退款直接退回原卡
- 超商代碼退款需人工處理

\`\`\`typescript
const cancelOrder = async (orderId: string) => {
  const order = await getOrder(orderId);

  if (order.status !== 'PAID') {
    throw new Error('只有已付款訂單可取消');
  }

  // 1. 退款
  await paymentService.refund(order.paymentId);

  // 2. 恢復庫存
  await restoreStock(order.items);

  // 3. 更新訂單
  await updateOrderStatus(orderId, 'CANCELLED');

  // 4. 通知
  await sendCancellationSMS(order.userId);
};
\`\`\`
```

---

## ✅ 最佳實踐

### 1. 保持更新
- 業務規則改變時更新文件
- 新增第三方整合時記錄
- 架構調整時說明原因

### 2. 適度詳細
- 不要過度詳細導致難以維護
- 聚焦在 AI 需要理解的部分
- 複雜邏輯提供程式碼範例

### 3. 團隊共識
- 與團隊確認術語使用
- 確保業務規則描述正確
- 定期審查更新

---

## 🔑 關鍵要點

> **豐富的專案上下文讓 AI 深入理解您的業務,產生更準確、更符合需求的程式碼。**

記住:
- 📚 說明業務領域和核心概念
- 📖 定義專案特定術語
- 🏗️ 記錄架構決策和原因
- 📜 解釋歷史遺留和特殊情境

---

## 📚 延伸閱讀

- [5.3 團隊協作設定](./5.3-team-collaboration.md)
- [2.3 完整範例解析](../chapter2/2.3-complete-example.md)

## 導航

- **上一節**: [5.1 動態調整 System Prompt](./5.1-dynamic-adjustment.md)
- **下一節**: [5.3 團隊協作設定](./5.3-team-collaboration.md)
- **返回**: [教材首頁](../../README.md)
