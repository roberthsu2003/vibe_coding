# 5.4 多語言專案處理

## 💡 概念說明

多語言專案是指在同一個專案中使用多種程式語言,例如前端 TypeScript、後端 Python、資料處理 R 等。每種語言都有自己的最佳實踐和規範。

---

## 🎯 多語言專案的挑戰

### 常見問題
- ❌ 不同語言的命名規範衝突
- ❌ 縮排空格數不一致
- ❌ 註解語言不統一
- ❌ AI 混淆不同語言的規範

### 解決策略
- ✅ 使用資料夾層級 `CLAUDE.md`
- ✅ 明確標示語言特定規範
- ✅ 保持通用規範一致
- ✅ 提供跨語言對照

---

## 📋 設定策略

### 策略 1: 資料夾分離

```
polyglot-project/
├── CLAUDE.md              # 通用規範
├── typescript/
│   ├── CLAUDE.md         # TypeScript 規範
│   └── src/
├── python/
│   ├── CLAUDE.md         # Python 規範
│   └── src/
└── rust/
    ├── CLAUDE.md         # Rust 規範
    └── src/
```

### 策略 2: 明確語言標示

**根目錄 `CLAUDE.md`:**

```markdown
# 多語言專案規範

## 🌐 專案語言
本專案使用多種程式語言:
- **TypeScript**: 前端和 Node.js 後端
- **Python**: 資料處理和機器學習
- **Rust**: 高效能運算模組

## 📏 通用規範(所有語言)

### 註解語言
- 所有註解使用**繁體中文**
- API 文件使用**英文**(國際化考量)

### Git 規範
- Commit message 使用繁體中文
- 遵循 Conventional Commits

### 測試要求
- 單元測試覆蓋率 > 80%
- 包含整合測試

## 🔄 語言特定規範
請參考各語言目錄下的 `CLAUDE.md`:
- [TypeScript 規範](./typescript/CLAUDE.md)
- [Python 規範](./python/CLAUDE.md)
- [Rust 規範](./rust/CLAUDE.md)
```

---

## 📝 語言特定設定範例

### TypeScript 模組

**`typescript/CLAUDE.md`:**

```markdown
# TypeScript 模組規範

⚠️ **本模組使用 TypeScript**,以下規範覆蓋專案預設值

## 技術棧
- TypeScript 5.0+
- Node.js 20 LTS
- pnpm

## 編碼規範
- **縮排**: 2 空格
- **命名**: camelCase (變數/函數), PascalCase (類別/介面)
- **字串**: 單引號
- **型別**: 啟用 strict mode

## 範例
\`\`\`typescript
interface User {
  id: string;
  name: string;
}

const getUser = async (id: string): Promise<User> => {
  return await userService.findById(id);
};
\`\`\`
```

### Python 模組

**`python/CLAUDE.md`:**

```markdown
# Python 模組規範

⚠️ **本模組使用 Python**,規範與 TypeScript 不同

## 技術棧
- Python 3.11+
- Poetry 套件管理
- pytest 測試

## 編碼規範
- **縮排**: 4 空格 (Python PEP 8)
- **命名**: snake_case (變數/函數), PascalCase (類別)
- **字串**: 雙引號(與 TypeScript 相反)
- **行寬**: 88 字元 (Black formatter)

## 型別提示
\`\`\`python
from typing import Optional

def get_user(user_id: str) -> Optional[dict]:
    """取得使用者資料

    Args:
        user_id: 使用者 ID

    Returns:
        使用者資料字典,不存在時返回 None
    """
    return user_service.find_by_id(user_id)
\`\`\`
```

### Rust 模組

**`rust/CLAUDE.md`:**

```markdown
# Rust 模組規範

⚠️ **本模組使用 Rust**,強調安全性和效能

## 技術棧
- Rust 1.75+
- Cargo 套件管理

## 編碼規範
- **縮排**: 4 空格 (Rust 標準)
- **命名**: snake_case (變數/函數/模組), PascalCase (型別/Trait)
- **錯誤處理**: 使用 Result<T, E>
- **所有權**: 明確標註生命週期

## 範例
\`\`\`rust
use std::error::Error;

/// 取得使用者資料
///
/// # Arguments
/// * `user_id` - 使用者 ID
///
/// # Returns
/// 使用者資料或錯誤
pub fn get_user(user_id: &str) -> Result<User, Box<dyn Error>> {
    user_service::find_by_id(user_id)
}
\`\`\`
```

---

## 🔄 跨語言對照表

### 命名規範對照

| 語言 | 變數/函數 | 類別/型別 | 常數 | 檔案 |
|:-----|:---------|:---------|:-----|:-----|
| TypeScript | camelCase | PascalCase | UPPER_SNAKE | kebab-case |
| Python | snake_case | PascalCase | UPPER_SNAKE | snake_case |
| Rust | snake_case | PascalCase | SCREAMING_SNAKE | snake_case |
| Go | camelCase/MixedCaps | PascalCase | PascalCase | snake_case |

### 縮排規範對照

| 語言 | 縮排 | 原因 |
|:-----|:-----|:-----|
| TypeScript/JavaScript | 2 空格 | 社群慣例 |
| Python | 4 空格 | PEP 8 規範 |
| Rust | 4 空格 | Rust 標準 |
| Go | Tab | Go 官方規範 |

### 字串規範對照

| 語言 | 偏好 | 原因 |
|:-----|:-----|:-----|
| TypeScript | 單引號 `'` | Prettier 預設 |
| Python | 雙引號 `"` | PEP 8 建議 |
| Rust | 雙引號 `"` | Rust 標準 |

---

## 🎨 實際專案範例

### 全端 + 資料處理專案

```
ai-platform/
├── CLAUDE.md                    # 通用規範
├── frontend/                   # TypeScript React
│   └── CLAUDE.md
├── backend/                    # TypeScript Node.js
│   └── CLAUDE.md
├── ml-service/                 # Python
│   └── CLAUDE.md
├── data-pipeline/              # Python
│   └── CLAUDE.md
└── performance-core/           # Rust
    └── CLAUDE.md
```

**根目錄 `CLAUDE.md`:**

```markdown
# AI 平台專案

## 架構概覽
- **前端**: TypeScript + React
- **後端 API**: TypeScript + Express
- **ML 服務**: Python + FastAPI
- **資料處理**: Python + Pandas
- **效能核心**: Rust

## 跨語言通用規範

### API 契約
所有服務間通訊使用 JSON,型別定義在 `types/` 共用

### 錯誤碼統一
\`\`\`
1000-1999: 前端錯誤
2000-2999: 後端 API 錯誤
3000-3999: ML 服務錯誤
4000-4999: 資料處理錯誤
5000-5999: 效能核心錯誤
\`\`\`

### 日誌格式
所有語言使用統一的 JSON 日誌格式:
\`\`\`json
{
  "timestamp": "2024-01-15T10:30:00Z",
  "level": "INFO",
  "service": "ml-service",
  "message": "預測完成",
  "metadata": {}
}
\`\`\`

### 環境變數
所有語言使用相同的環境變數名稱:
- `DATABASE_URL`
- `REDIS_URL`
- `LOG_LEVEL`
```

---

## 🔍 跨語言互動處理

### 1. 型別定義共用

```typescript
// types/shared.ts (TypeScript)
export interface PredictionRequest {
  model_id: string;
  input_data: number[];
}

export interface PredictionResponse {
  prediction: number;
  confidence: number;
}
```

```python
# types/shared.py (Python)
from pydantic import BaseModel
from typing import List

class PredictionRequest(BaseModel):
    """預測請求 (對應 TypeScript 的 PredictionRequest)"""
    model_id: str
    input_data: List[float]

class PredictionResponse(BaseModel):
    """預測回應 (對應 TypeScript 的 PredictionResponse)"""
    prediction: float
    confidence: float
```

### 2. API 文件統一

```markdown
## API: POST /predict

### Request (所有語言通用)
\`\`\`json
{
  "model_id": "model_v1",
  "input_data": [1.0, 2.0, 3.0]
}
\`\`\`

### Response (所有語言通用)
\`\`\`json
{
  "prediction": 0.85,
  "confidence": 0.92
}
\`\`\`

### 實作

**TypeScript (呼叫方)**
\`\`\`typescript
const response = await axios.post<PredictionResponse>('/predict', {
  model_id: 'model_v1',
  input_data: [1.0, 2.0, 3.0]
});
\`\`\`

**Python (服務方)**
\`\`\`python
@app.post("/predict")
async def predict(request: PredictionRequest) -> PredictionResponse:
    # 處理邏輯
    pass
\`\`\`
```

---

## ✅ 最佳實踐

### 1. 明確標示語言
```markdown
⚠️ **本模組使用 Python**

以下規範覆蓋專案的 TypeScript 預設值:
- 使用 4 空格縮排 (而非 2 空格)
- 使用 snake_case (而非 camelCase)
```

### 2. 避免規範衝突
```markdown
## 通用規範(跨語言)
- 註解使用繁體中文 ✅
- 測試覆蓋率 > 80% ✅

## 語言特定規範
- 縮排: TypeScript 2空格, Python 4空格 ✅
- 命名: 各語言遵循自己的慣例 ✅
```

### 3. 提供對照文件
在 README 或文件中提供跨語言對照表,幫助開發者快速切換。

---

## 🔑 關鍵要點

> **多語言專案需要在保持各語言最佳實踐的同時,維護整體一致性。**

記住:
- 📂 使用資料夾層級分離語言規範
- ⚠️ 明確標示語言特定設定
- 🔄 提供跨語言對照表
- 🌐 通用規範保持一致

---

## 📚 延伸閱讀

- [3.2 實際應用場景](../chapter3/3.2-use-cases.md)
- [5.5 測試要求整合](./5.5-testing-integration.md)

## 導航

- **上一節**: [5.3 團隊協作設定](./5.3-team-collaboration.md)
- **下一節**: [5.5 測試要求整合](./5.5-testing-integration.md)
- **返回**: [教材首頁](../../README.md)
