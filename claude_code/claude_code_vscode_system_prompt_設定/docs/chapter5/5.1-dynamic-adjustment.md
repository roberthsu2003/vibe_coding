# 5.1 動態調整 System Prompt

## 💡 概念說明

動態調整 System Prompt 是指在不修改 `CLAUDE.md` 檔案的情況下,臨時改變 AI 的行為模式。這對於特殊情境或一次性任務特別有用。

---

## 🔧 CLI 工具動態調整

### 使用命令列參數

CLI 工具提供 `--append-system-prompt` 參數,可以即時附加額外的指令:

```bash
# 基本用法
claude -p "建立一個使用者元件" \
  --append-system-prompt "使用 TypeScript 和詳細註解"

# 複雜範例
claude -p "重構這個函數" \
  --append-system-prompt "優先考慮效能,使用函數式程式設計風格,加入完整的錯誤處理"
```

### 使用場景

#### 1. 臨時改變程式碼風格
```bash
# 通常用 2 空格,這次用 4 空格
claude -p "建立設定檔" \
  --append-system-prompt "使用 4 空格縮排,遵循 Python PEP 8"
```

#### 2. 增加特定需求
```bash
# 原型開發,快速優先
claude -p "建立登入頁面" \
  --append-system-prompt "這是原型,快速實作優先,可省略完整驗證"
```

#### 3. 特殊文件需求
```bash
# 建立英文文件
claude -p "為此 API 建立文件" \
  --append-system-prompt "文件使用英文撰寫,包含詳細範例"
```

---

## 💬 VSCode 對話式調整

### 在對話中明確指示

雖然 VSCode 擴充套件沒有命令列參數,但您可以在對話中明確給予臨時指令:

```
使用者: 請建立一個按鈕元件

【這次特別要求】
- 使用 4 空格縮排(而非專案預設的 2 空格)
- 註解使用英文
- 包含完整的 accessibility 屬性
```

### 範圍限定的指令

```
使用者: 為接下來的 3 個元件,請遵循以下額外規則:
1. 使用 class-based 樣式(這次不用 Tailwind)
2. 包含詳細的 PropTypes
3. 加入使用範例

現在請建立 Button, Input, Card 三個元件。
```

---

## 🎯 情境式調整策略

### 策略 1: 開發階段調整

**原型階段:**
```bash
claude --append-system-prompt "
快速原型開發模式:
- 可使用 any 型別
- 可省略錯誤處理
- 專注核心功能
- 程式碼品質次要
"
```

**生產階段:**
```bash
claude --append-system-prompt "
生產環境模式:
- 嚴格型別檢查
- 完整錯誤處理
- 包含單元測試
- 最佳化效能
"
```

### 策略 2: 任務特定調整

**重構任務:**
```bash
claude -p "重構 userService.ts" \
  --append-system-prompt "
重構重點:
- 保持功能不變
- 提升可讀性
- 減少重複程式碼
- 加入型別註解
- 不改變 API 介面
"
```

**文件生成:**
```bash
claude -p "為所有 API 生成文件" \
  --append-system-prompt "
文件要求:
- 使用 JSDoc 格式
- 包含使用範例
- 說明所有參數
- 列出可能的錯誤
- 繁體中文撰寫
"
```

---

## 📋 環境變數方式

### 設定環境變數

```bash
# 設定臨時的 System Prompt
export CLAUDE_EXTRA_PROMPT="所有回應包含詳細說明和範例"

# 使用 CLI
claude -p "建立 API 端點"

# 清除環境變數
unset CLAUDE_EXTRA_PROMPT
```

### Shell 腳本整合

```bash
#!/bin/bash
# develop.sh - 開發模式腳本

export CLAUDE_EXTRA_PROMPT="
開發模式:
- 快速迭代
- 詳細註解
- 包含 console.log 除錯
"

claude "$@"

unset CLAUDE_EXTRA_PROMPT
```

使用方式:
```bash
./develop.sh -p "建立使用者介面"
```

---

## 🔄 動態切換最佳實踐

### 1. 明確標示臨時性

```bash
# ✅ 好的做法
claude -p "建立元件" \
  --append-system-prompt "【臨時要求】這次使用 4 空格縮排"

# ❌ 避免
claude -p "建立元件" \
  --append-system-prompt "使用 4 空格"  # 不清楚是否為臨時需求
```

### 2. 避免與專案規範衝突

```bash
# ⚠️ 衝突範例
# 專案規範: TypeScript + 2 空格
claude --append-system-prompt "使用 JavaScript 和 4 空格"

# ✅ 更好的做法
claude --append-system-prompt "
特殊情況: 產生給外部團隊的範例程式碼
- 使用 JavaScript (而非專案的 TypeScript)
- 使用 4 空格(外部團隊規範)
"
```

### 3. 記錄特殊調整

```bash
# 在 commit message 中記錄
git commit -m "feat: 建立外部 API 範例

使用特殊設定:
- JavaScript (非專案標準的 TypeScript)
- 英文註解 (提供給國際團隊)
"
```

---

## 🎨 模板化臨時指令

### 建立常用指令模板

```bash
# ~/.claude/prompts/quick-prototype.txt
快速原型模式:
- 省略型別定義
- 簡化錯誤處理
- 專注核心邏輯
- 使用 console.log 除錯

# 使用
claude -p "建立功能" \
  --append-system-prompt "$(cat ~/.claude/prompts/quick-prototype.txt)"
```

### 團隊共用模板

```
project/
└── .claude/
    └── prompts/
        ├── prototype.md      # 原型開發
        ├── production.md     # 生產環境
        ├── documentation.md  # 文件生成
        └── refactoring.md    # 程式碼重構
```

使用範例:
```bash
claude -p "建立登入功能" \
  --append-system-prompt "$(cat .claude/prompts/production.md)"
```

---

## 💡 實用範例

### 範例 1: 跨團隊協作

```bash
# 為使用不同規範的團隊產生程式碼
claude -p "建立共用元件" \
  --append-system-prompt "
目標團隊規範:
- 使用 4 空格縮排
- class-based 元件
- PropTypes 驗證
- 英文註解
"
```

### 範例 2: 學習目的

```bash
# 產生教學用的詳細程式碼
claude -p "建立排序演算法" \
  --append-system-prompt "
教學目的:
- 包含詳細註解說明每一步
- 提供時間複雜度分析
- 加入視覺化說明
- 包含多個範例
"
```

### 範例 3: 效能優化

```bash
# 專注效能的重構
claude -p "優化這段程式碼" \
  --append-system-prompt "
效能優化重點:
- 減少時間複雜度
- 最小化記憶體使用
- 避免不必要的計算
- 使用適當的資料結構
- 加入效能測試
"
```

---

## 🔑 關鍵要點

> **動態調整讓您在不修改專案規範的情況下,針對特殊需求臨時改變 AI 行為。**

記住:
- 🎯 用於特殊情況或一次性任務
- 📝 明確標示為臨時需求
- ⚠️ 避免與專案規範衝突
- 📋 可建立常用模板重複使用

---

## 📚 延伸閱讀

- [5.2 專案特定上下文](./5.2-project-context.md)
- [5.3 團隊協作設定](./5.3-team-collaboration.md)
- [CLI 工具完整指南](../chapter2/2.4-vscode-vs-cli.md)

## 導航

- **上一章**: [第四章: 實用範例集](../chapter4/README.md)
- **下一節**: [5.2 專案特定上下文](./5.2-project-context.md)
- **返回**: [教材首頁](../../README.md)
