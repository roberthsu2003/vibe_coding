# 3.2 實際應用場景

## 💡 概述

本節介紹資料夾層級設定的實際應用場景,幫助您判斷何時以及如何使用這項功能。

---

## 🎯 場景 1: 前後端分離專案

### 專案結構

```
fullstack-app/
├── CLAUDE.md              # 專案通用規範
├── frontend/
│   └── CLAUDE.md         # React + TypeScript
├── backend/
│   └── CLAUDE.md         # Node.js + Express
└── shared/
    └── types/            # 共用型別定義
```

### 根目錄 `CLAUDE.md`

```markdown
# 全端專案通用規範

## 通用規範
- 使用 TypeScript
- 註解使用繁體中文
- 遵循 Git Conventional Commits
- 所有 public 函數需要 JSDoc

## 測試要求
- 單元測試覆蓋率 > 80%
- 使用 Jest 測試框架
```

### `frontend/CLAUDE.md`

```markdown
# 前端模組設定

繼承專案通用規範,額外遵循:

## React 規範
- 使用 Function Components
- 使用 React Hooks
- Props 需定義 interface

## 樣式規範
- 使用 Tailwind CSS
- 不使用 CSS-in-JS
- 元件樣式保持模組化

## 狀態管理
- 使用 Zustand
- 全域狀態最小化
- 優先使用 React Context
```

### `backend/CLAUDE.md`

```markdown
# 後端模組設定

繼承專案通用規範,額外遵循:

## API 設計
- RESTful API 設計
- 使用 Express.js
- 統一錯誤處理中介軟體

## 資料庫
- 使用 Prisma ORM
- 所有查詢需要錯誤處理
- 避免 N+1 查詢問題

## 安全性
- 所有端點需要驗證
- 敏感資料加密
- 實作 Rate Limiting
```

---

## 🔒 場景 2: 不同安全等級的模組

### 專案結構

```
app/
├── CLAUDE.md
├── src/
│   ├── public/           # 公開模組
│   ├── protected/
│   │   └── CLAUDE.md    # 需要登入
│   └── admin/
│       └── CLAUDE.md    # 最高權限
```

### `src/protected/CLAUDE.md`

```markdown
# Protected 模組設定

## 驗證要求
- 所有操作檢查使用者登入狀態
- 使用 JWT 驗證
- Token 過期時間 24 小時

## 錯誤處理
- 未登入返回 401
- 權限不足返回 403
- 不洩露敏感錯誤資訊
```

### `src/admin/CLAUDE.md`

```markdown
# Admin 模組設定 (最高安全等級)

## 嚴格驗證
- 檢查 admin 角色權限
- 二次驗證敏感操作
- 記錄所有管理操作

## 資料保護
- 敏感資料必須加密
- 避免在前端暴露完整資料
- 實作資料遮罩

## 稽核日誌
- 記錄使用者 ID
- 記錄操作時間
- 記錄變更內容
- 記錄 IP 位址

## 禁止事項
- ❌ 不允許批次刪除(需逐筆確認)
- ❌ 不允許直接 SQL 查詢
- ❌ 不允許繞過驗證流程
```

---

## 🔧 場景 3: Legacy 程式碼維護

### 專案結構

```
project/
├── CLAUDE.md
├── src/
│   └── v2/              # 新版本
└── legacy/
    └── CLAUDE.md        # 舊版程式碼
```

### `legacy/CLAUDE.md`

```markdown
# Legacy 程式碼維護規範

⚠️ **重要提示**: 這是舊版程式碼,維護時遵循以下原則:

## 維護原則
- 🚫 不要重構架構
- ✅ 只修復 bug
- ✅ 保持原有程式碼風格
- ✅ 最小化變更範圍

## 允許的技術
這個模組使用舊技術棧,允許:
- jQuery (其他地方禁用)
- Class Components (主專案已禁用)
- var 宣告 (主專案要求 const/let)

## 修改指南
1. 先確認 bug 確實存在
2. 找到最小修改點
3. 不引入新依賴
4. 測試不影響其他功能
5. 詳細記錄變更原因

## 測試要求
- 手動測試所有相關功能
- 回歸測試確保無副作用
- 在舊版瀏覽器測試
```

---

## 🧪 場景 4: 測試程式碼專屬規範

### 專案結構

```
project/
├── CLAUDE.md
├── src/
│   ├── components/
│   └── utils/
└── tests/
    └── CLAUDE.md        # 測試專屬規則
```

### `tests/CLAUDE.md`

```markdown
# 測試程式碼規範

## 測試組織
- 使用 describe 區塊組織測試
- 測試名稱使用「應該...」格式
- 一個測試一個斷言 (SPOT 原則)

## 測試結構
\`\`\`typescript
describe('元件/函數名稱', () => {
  // 前置設定
  beforeEach(() => {
    // setup
  });

  it('應該在 [情境] 時 [預期結果]', () => {
    // Arrange
    // Act
    // Assert
  });
});
\`\`\`

## Mock 規範
- 使用 Jest mock
- Mock 最小化
- 清楚標示 Mock 資料
- 測試後清除 Mock

## 測試資料
- 使用有意義的測試資料
- 避免魔術數字
- 測試資料放在 `__fixtures__`

## 覆蓋率要求
- 單元測試: > 80%
- 整合測試: > 60%
- E2E 測試: 核心流程 100%
```

---

## 📱 場景 5: 多平台專案

### 專案結構

```
cross-platform/
├── CLAUDE.md
├── web/
│   └── CLAUDE.md        # Web 應用
├── mobile/
│   └── CLAUDE.md        # React Native
├── desktop/
│   └── CLAUDE.md        # Electron
└── shared/              # 共用程式碼
```

### `mobile/CLAUDE.md`

```markdown
# Mobile 應用設定 (React Native)

## 平台考量
- 同時支援 iOS 和 Android
- 考慮不同螢幕尺寸
- 處理安全區域 (Safe Area)
- 支援深淺色主題

## 效能要求
- 避免過度渲染
- 圖片使用懶載入
- 列表使用 FlatList (不用 map)
- 動畫使用 Reanimated

## 原生功能
- 使用 react-native 模組
- 相機、定位需要權限檢查
- 處理平台特定程式碼

\`\`\`typescript
// 平台特定程式碼範例
import { Platform } from 'react-native';

const styles = Platform.select({
  ios: { /* iOS 樣式 */ },
  android: { /* Android 樣式 */ }
});
\`\`\`

## 禁止事項
- ❌ 不使用 web-only 套件
- ❌ 不使用 window/document
- ❌ 避免大量 inline styles
```

---

## 🐍 場景 6: 多語言專案

### 專案結構

```
polyglot-project/
├── CLAUDE.md             # 通用規範
├── typescript/
│   └── CLAUDE.md        # TS 規範
├── python/
│   └── CLAUDE.md        # Python 規範
└── rust/
    └── CLAUDE.md        # Rust 規範
```

### `python/CLAUDE.md`

```markdown
# Python 模組規範

⚠️ 本模組使用 Python,以下規則**覆蓋**專案的 TypeScript 預設值

## Python 規範
- Python 3.11+
- 遵循 PEP 8
- 使用 4 空格縮排
- 最大行寬 88 字元 (Black formatter)

## 命名慣例
- 變數/函數: snake_case
- 類別: PascalCase
- 常數: UPPER_SNAKE_CASE
- 私有成員: _leading_underscore

## 型別提示
\`\`\`python
def process_data(
    items: list[dict[str, Any]],
    threshold: float = 0.5
) -> pd.DataFrame:
    """處理資料並返回 DataFrame"""
    pass
\`\`\`

## 專案特定工具
- Poetry 管理依賴
- Black 格式化
- Ruff linting
- pytest 測試
```

---

## 🚀 場景 7: 微服務架構

### 專案結構

```
microservices/
├── CLAUDE.md             # 共用規範
├── services/
│   ├── auth/
│   │   └── CLAUDE.md    # 驗證服務
│   ├── payment/
│   │   └── CLAUDE.md    # 支付服務
│   └── notification/
│       └── CLAUDE.md    # 通知服務
└── shared/
    └── proto/           # gRPC 定義
```

### `services/payment/CLAUDE.md`

```markdown
# Payment 服務規範

## 服務特性
- 處理金流交易
- 最高安全等級
- 要求強一致性

## 安全要求
- 所有金額使用 Decimal (不用 float)
- 敏感資料加密儲存
- 使用 HTTPS only
- 實作 3D Secure
- PCI DSS 合規

## 錯誤處理
\`\`\`typescript
// 付款錯誤必須詳細記錄
try {
  await processPayment(amount, cardToken);
} catch (error) {
  logger.error('Payment failed', {
    amount,
    userId,
    errorCode: error.code,
    timestamp: new Date().toISOString()
  });
  // 觸發告警
  await alertService.criticalError(error);
  throw error;
}
\`\`\`

## 測試要求
- 100% 覆蓋率(金流相關)
- 模擬各種失敗情況
- 測試交易回滾
- 測試重複請求處理

## 監控
- 記錄所有交易
- 監控成功率
- 追蹤回應時間
- 異常立即告警
```

---

## 📊 場景對照表

| 場景 | 使用時機 | 核心目的 |
|:-----|:---------|:---------|
| **前後端分離** | 不同技術棧 | 各自的最佳實踐 |
| **安全等級** | 不同權限要求 | 分級安全控制 |
| **Legacy 維護** | 維護舊程式碼 | 特殊維護規則 |
| **測試程式碼** | 測試相關檔案 | 測試專屬規範 |
| **多平台** | Web/Mobile/Desktop | 平台特定處理 |
| **多語言** | TypeScript/Python/Rust | 語言特定規範 |
| **微服務** | 獨立服務模組 | 服務專屬規則 |

---

## 💡 選擇指南

### 何時使用資料夾層級設定

✅ **應該使用**:
- 技術棧完全不同
- 安全需求差異大
- 程式碼風格不同(如 Legacy)
- 測試vs生產程式碼
- 不同平台或語言

❌ **不需要使用**:
- 僅有些微差異
- 規則基本相同
- 可用註解說明的情況
- 暫時性的需求

---

## 🎯 實作建議

1. **評估需求**: 確認真的需要不同規則
2. **最小化差異**: 只列出真正不同的部分
3. **明確繼承**: 說明繼承哪些規則
4. **文件記錄**: 在 README 說明結構
5. **定期審查**: 檢查是否還需要

---

## 📚 下一步

了解應用場景後,接著學習如何實作:
- [3.3 階層化設定實戰](./3.3-hierarchical-setup.md) - 手把手建立多層設定

## 導航

- **上一節**: [3.1 資料夾層級設定概念](./3.1-folder-level-concept.md)
- **下一節**: [3.3 階層化設定實戰](./3.3-hierarchical-setup.md)
- **返回**: [教材首頁](../../README.md)
