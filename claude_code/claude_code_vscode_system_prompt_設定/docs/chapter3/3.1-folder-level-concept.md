# 3.1 資料夾層級設定概念

## 💡 什麼是資料夾層級設定

資料夾層級設定允許您在專案的**特定資料夾**中建立獨立的 `CLAUDE.md` 檔案,為該資料夾及其子資料夾定義專屬的 System Prompt 規則。

---

## 🎯 為什麼需要資料夾層級設定

### 1. 不同模組有不同需求

現代專案通常包含多個模組,每個模組可能有不同的規範:

```
project/
├── CLAUDE.md              # 專案通用規範
├── frontend/
│   └── CLAUDE.md         # 前端特定規則
├── backend/
│   └── CLAUDE.md         # 後端特定規則
└── admin/
    └── CLAUDE.md         # Admin 特定規則
```

### 2. 特殊安全需求

某些模組需要額外的安全檢查:

```
project/
├── src/
│   ├── public/           # 一般模組
│   └── admin/
│       └── CLAUDE.md     # 嚴格的權限檢查要求
```

### 3. 不同的技術棧

同一專案可能使用不同技術:

```
project/
├── web/
│   └── CLAUDE.md         # React + TypeScript
├── mobile/
│   └── CLAUDE.md         # React Native
└── api/
    └── CLAUDE.md         # Node.js + Express
```

---

## 🔄 階層式覆蓋機制

### 優先級規則

```
資料夾層級 CLAUDE.md (最高優先級)
    ↓ 覆蓋/合併
專案根目錄 CLAUDE.md
    ↓ 覆蓋/合併
VS Code 工作區設定
    ↓ 覆蓋/合併
VS Code 使用者設定 (最低優先級)
```

### 實際範例

**專案根目錄 `CLAUDE.md`:**
```markdown
## 通用規範
- 使用 TypeScript
- 註解使用繁體中文
- 2 空格縮排
```

**`src/admin/CLAUDE.md`:**
```markdown
## Admin 模組特定規範
- 所有操作需要權限檢查
- 敏感資料必須加密
- 記錄所有操作日誌
```

**結果:** 在 `src/admin/` 編輯檔案時
- ✅ 使用 TypeScript (繼承自根目錄)
- ✅ 註解使用繁體中文 (繼承自根目錄)
- ✅ 2 空格縮排 (繼承自根目錄)
- ✅ 需要權限檢查 (Admin 專屬)
- ✅ 敏感資料加密 (Admin 專屬)
- ✅ 記錄操作日誌 (Admin 專屬)

---

## 📁 設定範圍

### 作用域

資料夾層級的 `CLAUDE.md` 會影響:

```
src/admin/
├── CLAUDE.md           ← 這個檔案
├── dashboard.tsx       ✅ 受影響
├── users/
│   ├── list.tsx       ✅ 受影響
│   └── edit.tsx       ✅ 受影響
└── settings/
    └── config.tsx     ✅ 受影響
```

### 不受影響的檔案

```
project/
├── CLAUDE.md
├── src/
│   ├── admin/
│   │   └── CLAUDE.md
│   ├── public/
│   │   └── home.tsx   ❌ 不受 admin/CLAUDE.md 影響
│   └── components/
│       └── Button.tsx ❌ 不受 admin/CLAUDE.md 影響
```

---

## 🎨 設定策略

### 策略 1: 完全覆蓋

子資料夾完全定義自己的規則:

```markdown
# src/legacy/CLAUDE.md

## Legacy 程式碼規範
- 這是舊程式碼,不要重構
- 只修復 bug,不改架構
- 保持原有風格
```

### 策略 2: 增量添加

子資料夾補充額外規則:

```markdown
# src/api/CLAUDE.md

## API 層額外規範
繼承專案的所有規範,並額外遵循:
- 所有端點需要錯誤處理
- 回應格式統一為 JSON
- 使用 Zod 驗證輸入
```

### 策略 3: 特殊覆蓋

只覆蓋特定項目:

```markdown
# src/prototype/CLAUDE.md

## 原型開發規範
⚠️ 這是原型程式碼,以下規則不同於主專案:

- ❌ 可以使用 `any` 型別
- ❌ 可以省略錯誤處理
- ✅ 快速迭代優先
- ✅ 程式碼品質次要
```

---

## 🔍 識別機制

Claude Code 如何知道使用哪個 `CLAUDE.md`?

### 向上搜尋機制

1. 從**目前編輯的檔案**所在目錄開始
2. 尋找 `CLAUDE.md`
3. 如果找到,載入它
4. 繼續向上層搜尋
5. 合併所有找到的 `CLAUDE.md`

### 搜尋範例

編輯 `src/admin/users/edit.tsx` 時:

```
1. 檢查 src/admin/users/CLAUDE.md  → 未找到
2. 檢查 src/admin/CLAUDE.md        → ✅ 找到,載入
3. 檢查 src/CLAUDE.md              → 未找到
4. 檢查 project/CLAUDE.md          → ✅ 找到,載入
5. 停止搜尋 (已到專案根目錄)
```

最終使用: `src/admin/CLAUDE.md` + `project/CLAUDE.md` (合併)

---

## ⚙️ VSCode vs CLI 支援

### VSCode 擴充套件
- ✅ 完整支援資料夾層級 `CLAUDE.md`
- ✅ 自動向上搜尋並合併
- ✅ 即時生效

### CLI 工具
- ✅ 完整支援資料夾層級 `CLAUDE.md`
- ✅ 自動向上搜尋並合併
- ✅ 可用命令列參數覆蓋

---

## 💡 最佳實踐

### 1. 保持簡潔

❌ **避免:**
```markdown
# src/admin/CLAUDE.md
[重複專案根目錄的所有內容]
+ 一些 admin 特定規則
```

✅ **推薦:**
```markdown
# src/admin/CLAUDE.md
## Admin 模組特定規範
(只列出 admin 專屬的規則)
```

### 2. 明確說明繼承關係

```markdown
# src/mobile/CLAUDE.md

## 📱 Mobile 模組設定
本模組**繼承專案根目錄的所有規範**,並額外遵循:

### React Native 特定規則
- 使用 React Native 元件
- 考慮行動裝置效能
- 支援 iOS 和 Android
```

### 3. 避免衝突

❌ **避免相互矛盾的規則:**

根目錄:
```markdown
- 使用 2 空格縮排
```

子資料夾:
```markdown
- 使用 4 空格縮排  ← 衝突!
```

✅ **如果需要不同規則,明確說明:**

```markdown
# src/python/CLAUDE.md

## Python 模組規範
⚠️ 本模組使用 Python,以下規則覆蓋專案預設:

- 使用 4 空格縮排 (Python PEP 8)
- 使用 snake_case 命名
```

---

## 🎯 使用時機

### ✅ 適合使用資料夾層級設定

1. **不同技術棧**
   ```
   project/
   ├── web/          # React
   ├── api/          # Node.js
   └── ml/           # Python
   ```

2. **特殊安全需求**
   ```
   project/
   ├── public/       # 一般
   └── admin/        # 嚴格權限
   ```

3. **Legacy 程式碼**
   ```
   project/
   ├── src/          # 新程式碼
   └── legacy/       # 舊程式碼,不同規範
   ```

4. **實驗性功能**
   ```
   project/
   ├── stable/       # 穩定版本
   └── experimental/ # 實驗功能
   ```

### ❌ 不建議使用

1. **規則幾乎相同** - 使用專案層級即可
2. **過度細分** - 每個小資料夾都有 `CLAUDE.md` 會難以維護
3. **沒有實質差異** - 為了設定而設定

---

## 📊 實際案例

### 案例: 電商專案

```
ecommerce/
├── CLAUDE.md                    # 專案通用規範
├── frontend/
│   ├── CLAUDE.md               # React + TypeScript
│   ├── customer/               # 客戶介面
│   └── admin/
│       └── CLAUDE.md           # Admin 嚴格權限
├── backend/
│   └── CLAUDE.md               # Node.js + Express
└── data-pipeline/
    └── CLAUDE.md               # Python 資料處理
```

每個 `CLAUDE.md` 只包含該層級特有的規則,避免重複。

---

## 🔑 關鍵要點

> **資料夾層級設定讓您能夠為專案的不同部分定義精確的規則,同時保持整體一致性。**

記住:
- 🎯 只在真正需要時使用
- 📝 保持設定簡潔
- 🔄 明確說明繼承關係
- ⚠️ 避免規則衝突

---

## 📚 下一步

了解概念後,接下來學習:
- [3.2 實際應用場景](./3.2-use-cases.md) - 具體使用案例
- [3.3 階層化設定實戰](./3.3-hierarchical-setup.md) - 手把手實作

## 導航

- **上一節**: [第三章首頁](./README.md)
- **下一節**: [3.2 實際應用場景](./3.2-use-cases.md)
- **返回**: [教材首頁](../../README.md)
