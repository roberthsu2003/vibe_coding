# 4.1 React + TypeScript 前端開發

## 📋 完整 CLAUDE.md 範例

以下是 React + TypeScript 專案的完整 System Prompt 設定:

```markdown
# 專案名稱: React + TypeScript 前端應用

## 🎯 專案概觀
這是一個使用 React 和 TypeScript 開發的現代化單頁應用 (SPA),
提供高效能、型別安全的使用者介面。

## ⚙️ 技術棧
- **程式語言**: TypeScript 5.0+
- **前端框架**: React 18
- **狀態管理**: Zustand 4.x
- **樣式方案**: Tailwind CSS 3.x
- **路由**: React Router v6
- **表單處理**: React Hook Form + Zod
- **HTTP 客戶端**: Axios
- **建置工具**: Vite
- **套件管理**: pnpm

## 📏 編碼規範與規則

### React 元件規範
- **僅使用 Function Components** (不使用 Class Components)
- 每個元件都要定義 Props 的 TypeScript interface
- Props interface 命名格式: `[ComponentName]Props`
- 元件檔案命名使用 PascalCase (例如: `UserProfile.tsx`)
- 一個檔案一個元件 (主元件)

#### 元件範例
\`\`\`typescript
interface UserProfileProps {
  userId: string;
  onUpdate?: (user: User) => void;
}

/**
 * 使用者個人資料元件
 * @param userId - 使用者 ID
 * @param onUpdate - 更新回調函數
 */
export const UserProfile = ({ userId, onUpdate }: UserProfileProps) => {
  // 元件邏輯
  return <div>...</div>;
};
\`\`\`

### TypeScript 規範
- 啟用嚴格模式 (`strict: true` in tsconfig.json)
- **絕對不使用 `any` 型別**,改用 `unknown` 或具體型別
- 優先使用型別推導,不需要顯式標註明顯的型別
- 使用 `interface` 定義物件結構
- 使用 `type` 定義聯合型別、交集型別
- 所有函數都要有明確的回傳型別

#### 型別定義範例
\`\`\`typescript
// ✅ 正確
interface User {
  id: string;
  name: string;
  email: string;
}

type UserRole = 'admin' | 'user' | 'guest';

const getUser = async (id: string): Promise<User> => {
  // ...
};

// ❌ 錯誤
const getUser = async (id: any) => {  // 不要用 any
  // ...
};
\`\`\`

### Hooks 使用規範
- 自訂 Hooks 命名必須以 `use` 開頭
- 遵循 Hooks 規則 (不在條件式、迴圈中呼叫)
- 複雜的狀態邏輯封裝成自訂 Hooks
- 使用 `useCallback` 和 `useMemo` 優化效能

#### Hooks 範例
\`\`\`typescript
/**
 * 取得使用者資料的 Hook
 */
const useUser = (userId: string) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    const fetchUser = async () => {
      try {
        const data = await userService.getUser(userId);
        setUser(data);
      } catch (err) {
        setError(err as Error);
      } finally {
        setLoading(false);
      }
    };

    fetchUser();
  }, [userId]);

  return { user, loading, error };
};
\`\`\`

### 命名慣例
- **變數和函數**: camelCase (例如: `getUserData`, `isLoading`)
- **元件和 Interface/Type**: PascalCase (例如: `UserCard`, `ButtonProps`)
- **常數**: UPPER_SNAKE_CASE (例如: `API_BASE_URL`, `MAX_RETRIES`)
- **檔案名稱**: kebab-case (例如: `user-profile.tsx`) 或 PascalCase (元件檔案)
- **資料夾名稱**: kebab-case (例如: `user-settings`)

### 程式碼風格
- 使用 **2 空格縮排**
- 使用**單引號**字串 (除非字串內含單引號)
- 每行最多 **100 字元**
- **Props 解構賦值**
- 使用 **Prettier** 自動格式化
- 遵循 **ESLint** 規則

### 函式規範
- 每個函數不超過 **50 行**程式碼
- 複雜函數拆分成多個小函數
- 使用**描述性的函數名稱**
- 優先使用**箭頭函數**
- 巢狀深度不超過 **3 層**

## 🏗️ 專案結構
\`\`\`
src/
├── components/           # 可重用的 UI 元件
│   ├── common/          # 通用元件 (Button, Input, Card 等)
│   └── features/        # 功能特定元件
├── pages/               # 頁面元件
├── hooks/               # 自訂 React Hooks
├── stores/              # Zustand 狀態管理
├── services/            # API 服務層
├── utils/               # 工具函數
├── types/               # TypeScript 類型定義
├── constants/           # 常數定義
├── styles/              # 全域樣式
└── App.tsx              # 應用程式入口
\`\`\`

## 🚫 禁止事項

### 不要使用的技術
- ❌ **Class Components** (使用 Function Components)
- ❌ **CSS-in-JS** 庫如 styled-components (使用 Tailwind CSS)
- ❌ **jQuery** (使用 React 和原生 API)
- ❌ **`any` 型別** (使用具體型別或 `unknown`)

### 不要的做法
- ❌ **不要使用 `export default`**
  ✅ 使用具名匯出 `export const ComponentName`

- ❌ **不要在元件內直接呼叫 API**
  ✅ 使用 `services/` 層或自訂 Hooks

- ❌ **不要直接修改 state**
  ✅ 使用 immutable 更新

- ❌ **不要在 render 中建立函數或物件**
  ✅ 使用 `useCallback` / `useMemo` 或移到外部

- ❌ **不要過度巢狀三元運算子**
  ✅ 拆分成多個變數或使用 if-else

### 範例對比
\`\`\`typescript
// ❌ 錯誤: export default
export default function UserCard() { ... }

// ✅ 正確: 具名匯出
export const UserCard = () => { ... };

// ❌ 錯誤: 在元件內直接呼叫 API
const UserList = () => {
  useEffect(() => {
    axios.get('/api/users').then(setUsers);
  }, []);
};

// ✅ 正確: 使用 service 層
const UserList = () => {
  useEffect(() => {
    userService.getUsers().then(setUsers);
  }, []);
};

// ❌ 錯誤: 直接修改
const addItem = (item) => {
  items.push(item);
  setItems(items);
};

// ✅ 正確: immutable 更新
const addItem = (item) => {
  setItems([...items, item]);
};
\`\`\`

## 🔗 API 互動規則

### API 服務層
所有與後端的互動都必須透過 `src/services/` 中的服務層進行。

#### API 客戶端設定
\`\`\`typescript
// src/services/apiClient.ts
import axios from 'axios';

export const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// 請求攔截器
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = \`Bearer \${token}\`;
  }
  return config;
});

// 回應攔截器
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // 處理未授權
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
\`\`\`

#### 服務範例
\`\`\`typescript
// src/services/userService.ts
import { apiClient } from './apiClient';
import { User, CreateUserInput } from '@/types/user';

export const userService = {
  /**
   * 取得所有使用者
   */
  getUsers: async (): Promise<User[]> => {
    const response = await apiClient.get<User[]>('/users');
    return response.data;
  },

  /**
   * 根據 ID 取得使用者
   */
  getUserById: async (id: string): Promise<User> => {
    const response = await apiClient.get<User>(\`/users/\${id}\`);
    return response.data;
  },

  /**
   * 建立新使用者
   */
  createUser: async (input: CreateUserInput): Promise<User> => {
    const response = await apiClient.post<User>('/users', input);
    return response.data;
  }
};
\`\`\`

## 🎨 樣式規範 (Tailwind CSS)

### Tailwind 使用規則
- 優先使用 Tailwind utility classes
- 避免 inline styles (除非動態樣式)
- 複雜元件提取為 Tailwind 元件類別
- 使用 `@apply` 封裝重複的 utility 組合

#### 樣式範例
\`\`\`typescript
// ✅ 正確: 使用 Tailwind classes
export const Button = ({ children, variant = 'primary' }: ButtonProps) => {
  const baseClasses = 'px-4 py-2 rounded-md font-medium transition-colors';
  const variantClasses = {
    primary: 'bg-blue-500 text-white hover:bg-blue-600',
    secondary: 'bg-gray-200 text-gray-800 hover:bg-gray-300'
  };

  return (
    <button className={\`\${baseClasses} \${variantClasses[variant]}\`}>
      {children}
    </button>
  );
};

// ❌ 錯誤: 使用 inline styles
export const Button = ({ children }: ButtonProps) => {
  return (
    <button style={{ padding: '8px 16px', backgroundColor: 'blue' }}>
      {children}
    </button>
  );
};
\`\`\`

## 🧪 測試要求
- 所有新功能都必須包含測試
- 測試覆蓋率應保持在 **80% 以上**
- 使用 **Jest + React Testing Library**
- 測試檔案命名: `ComponentName.test.tsx`
- 測試檔案與源檔案放在同一目錄

### 測試範例
\`\`\`typescript
// UserCard.test.tsx
import { render, screen } from '@testing-library/react';
import { UserCard } from './UserCard';

describe('UserCard', () => {
  it('應該正確顯示使用者名稱', () => {
    const user = { id: '1', name: 'John Doe', email: 'john@example.com' };
    render(<UserCard user={user} />);

    expect(screen.getByText('John Doe')).toBeInTheDocument();
  });

  it('應該在點擊時呼叫 onClick', async () => {
    const handleClick = jest.fn();
    const user = { id: '1', name: 'John Doe', email: 'john@example.com' };

    render(<UserCard user={user} onClick={handleClick} />);

    await userEvent.click(screen.getByRole('button'));

    expect(handleClick).toHaveBeenCalledWith(user.id);
  });
});
\`\`\`

## 📝 文件化要求
- 所有 **public 函數**都要有 JSDoc 註解
- 複雜邏輯需要**內聯註解**說明
- Props interface 要有清楚的註解
- **註解使用繁體中文**

### JSDoc 範例
\`\`\`typescript
/**
 * 格式化日期為本地化字串
 *
 * @param date - 要格式化的日期
 * @param format - 日期格式 (預設: 'YYYY-MM-DD')
 * @returns 格式化後的日期字串
 *
 * @example
 * formatDate(new Date()) // '2024-01-15'
 */
export const formatDate = (
  date: Date,
  format: string = 'YYYY-MM-DD'
): string => {
  // 實作邏輯
};
\`\`\`

## ⚡ 效能優化
- 使用 **React.memo** 避免不必要的重新渲染
- 大型列表使用**虛擬滾動** (react-window 或 react-virtual)
- 圖片使用**懶載入** (Intersection Observer 或 react-lazyload)
- 實作**程式碼分割** (React.lazy + Suspense)
- 避免在 render 中建立新的函數或物件

### 效能優化範例
\`\`\`typescript
// ✅ 使用 React.memo
export const UserCard = memo(({ user }: UserCardProps) => {
  return <div>{user.name}</div>;
});

// ✅ 使用 useCallback
const UserList = ({ users }: UserListProps) => {
  const handleUserClick = useCallback((userId: string) => {
    navigate(\`/users/\${userId}\`);
  }, [navigate]);

  return (
    <div>
      {users.map(user => (
        <UserCard key={user.id} user={user} onClick={handleUserClick} />
      ))}
    </div>
  );
};
\`\`\`

## 📋 Git 提交訊息規範
使用 **Conventional Commits** 格式:
- `feat:` - 新功能
- `fix:` - 錯誤修復
- `docs:` - 文件更新
- `style:` - 程式碼格式調整 (不影響功能)
- `refactor:` - 程式碼重構
- `test:` - 測試相關
- `chore:` - 建置/工具相關

### 提交訊息範例
\`\`\`bash
feat: 新增使用者個人資料頁面
fix: 修正登入表單驗證錯誤
docs: 更新 API 文件
refactor: 重構使用者服務層
\`\`\`
```

---

## 🎯 使用此設定

1. 複製上方完整內容
2. 儲存為專案根目錄的 `CLAUDE.md`
3. 根據您的專案需求調整

## 導航

- **上一章**: [第三章: 資料夾層級設定](../chapter3/README.md)
- **下一節**: [4.2 Node.js 後端開發](./4.2-nodejs-backend.md)
- **返回**: [教材首頁](../../README.md)
