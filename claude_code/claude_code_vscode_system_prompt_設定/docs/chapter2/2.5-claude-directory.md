# 2.5 .claude/ 目錄設定完整指南

## 💡 概念說明

`.claude/` 目錄是 **CLI 工具提供的進階設定方式**,允許您建立專案層級的配置檔案、自訂指令和 Prompt 模板。

> **⚠️ 重要提示:** `.claude/` 目錄設定主要是 **CLI 工具獨有功能**,VSCode 擴充套件**不直接支援**這些設定檔。但 VSCode 擴充套件會**使用 CLI 配置的 MCP 伺服器和 Subagents**。

---

## 📁 完整目錄結構

### 專案層級 `.claude/` 目錄

```
your-project/
├── CLAUDE.md                    # ✅ VSCode + CLI 都支援
├── .claude/                     # ⚠️ 主要為 CLI 工具
│   ├── settings.json           # CLI 專案設定
│   ├── commands/               # 自訂 Slash Commands
│   │   ├── review.md          # 程式碼審查指令
│   │   ├── test.md            # 測試生成指令
│   │   └── docs.md            # 文件生成指令
│   ├── prompts/                # Prompt 模板 (建議用途)
│   │   ├── prototype.md       # 原型開發模式
│   │   ├── production.md      # 生產環境模式
│   │   └── refactor.md        # 重構模式
│   └── cache/                  # 快取 (自動產生,加入 .gitignore)
└── .gitignore                  # 忽略 .claude/cache/
```

### 全域 `.claude/` 目錄 (使用者家目錄)

```
~/.claude/
├── CLAUDE.md                   # 全域 System Prompt
├── settings.json               # 全域 CLI 設定
├── prompts/                    # 全域 Prompt 模板
│   └── default.md
└── mcp/                        # MCP 伺服器設定
    └── config.json
```

---

## 📊 檔案用途對照表

### 專案層級設定檔

| 檔案 | 路徑 | VSCode 支援 | CLI 支援 | 用途 |
|:-----|:-----|:-----------|:---------|:-----|
| **CLAUDE.md** | `./CLAUDE.md` | ✅ 完整支援 | ✅ 完整支援 | 專案 System Prompt |
| **settings.json** | `./.claude/settings.json` | ❌ 不支援 | ✅ 完整支援 | CLI 專案配置 |
| **commands/** | `./.claude/commands/*.md` | ❌ 不支援 | ✅ 完整支援 | 自訂 Slash Commands |
| **prompts/** | `./.claude/prompts/*.md` | ❌ 不支援 | ✅ 可用 | Prompt 模板 (非官方) |

### 全域設定檔

| 檔案 | 路徑 | VSCode 支援 | CLI 支援 | 用途 |
|:-----|:-----|:-----------|:---------|:-----|
| **CLAUDE.md** | `~/.claude/CLAUDE.md` | ❌ 不支援 | ✅ 完整支援 | 全域預設 Prompt |
| **settings.json** | `~/.claude/settings.json` | ❌ 不支援 | ✅ 完整支援 | 全域 CLI 設定 |
| **MCP 配置** | `~/.claude/mcp/` | ⚠️ 使用 CLI 配置 | ✅ 完整支援 | MCP 伺服器設定 |

---

## 🔧 各檔案詳細說明

### 1. `.claude/settings.json` (專案配置)

**用途:** CLI 工具的專案層級設定

**範例:**
```json
{
  "model": "claude-sonnet-4-5-20250929",
  "max_tokens": 4096,
  "temperature": 0.7,
  "system_prompt": "這是 React 專案,使用 TypeScript 和 Tailwind CSS",
  "context_window": 8192,
  "streaming": true,
  "cache_responses": true,
  "include_patterns": [
    "*.ts",
    "*.tsx",
    "*.js",
    "*.jsx",
    "*.md"
  ],
  "exclude_patterns": [
    "node_modules/**",
    "dist/**",
    "build/**",
    "*.log"
  ]
}
```

**設定項目說明:**

| 設定 | 說明 | 預設值 |
|:-----|:-----|:-------|
| `model` | Claude 模型版本 | `claude-sonnet-4-5` |
| `max_tokens` | 最大回應 token 數 | `4096` |
| `temperature` | 創造性程度 (0-1) | `0.7` |
| `system_prompt` | 額外的 System Prompt | - |
| `context_window` | 上下文視窗大小 | `8192` |
| `include_patterns` | 包含的檔案模式 | `["*"]` |
| `exclude_patterns` | 排除的檔案模式 | `["node_modules/**"]` |

---

### 2. `.claude/commands/` (自訂 Slash Commands)

**用途:** 建立可重複使用的自訂指令

#### 範例 1: 程式碼審查指令

**`.claude/commands/review.md`:**
```markdown
---
description: 進行詳細的程式碼審查
---

你是一位資深的程式碼審查專家。請從以下角度檢查程式碼:

## 🔍 審查重點

### 1. 程式碼品質
- **可讀性**: 程式碼是否清晰易懂
- **可維護性**: 是否易於修改和擴展
- **最佳實踐**: 是否遵循業界標準

### 2. 安全性
- **輸入驗證**: 是否驗證所有使用者輸入
- **SQL 注入**: 檢查資料庫查詢安全性
- **XSS 漏洞**: 檢查輸出是否正確轉義
- **敏感資料**: 是否妥善處理密碼、API key 等

### 3. 效能
- **演算法效率**: 時間複雜度是否合理
- **記憶體使用**: 是否有記憶體洩漏風險
- **資料庫查詢**: 避免 N+1 查詢問題

### 4. 測試覆蓋
- 是否包含單元測試
- 測試是否涵蓋邊界情況
- 測試是否清晰易讀

## 📋 輸出格式

請按以下格式提供審查結果:

1. **總體評價** (1-10 分)
2. **主要問題** (列出 3-5 個最重要的問題)
3. **改進建議** (提供具體的程式碼範例)
4. **優點** (值得保留的好設計)
```

**使用方式:**
```bash
# 審查單一檔案
claude /review src/userService.ts

# 審查整個目錄
claude /review src/services/
```

#### 範例 2: 測試生成指令

**`.claude/commands/test.md`:**
```markdown
---
description: 為程式碼生成完整的單元測試
---

請為提供的程式碼生成完整的單元測試。

## 🧪 測試要求

### 測試框架
- 使用專案的測試框架 (Jest/Vitest/Mocha)
- 遵循 AAA 模式 (Arrange, Act, Assert)

### 必須涵蓋
1. ✅ **正常情況**: 正確輸入的預期行為
2. ✅ **邊界情況**: 極值、空值、null、undefined
3. ✅ **錯誤處理**: 異常輸入的錯誤處理
4. ✅ **非同步操作**: Promise、async/await 的正確測試

### 測試命名
使用格式: `應該在 [情境] 時 [預期結果]`

### Mock 規範
- Mock 外部依賴 (API、資料庫)
- 清楚標示 Mock 資料
- 測試後清除 Mock

## 📝 輸出範例

\`\`\`typescript
describe('功能名稱', () => {
  beforeEach(() => {
    // 設定
  });

  it('應該在正常情況下返回正確結果', () => {
    // Arrange
    const input = ...;

    // Act
    const result = functionName(input);

    // Assert
    expect(result).toBe(...);
  });

  it('應該在輸入為 null 時拋出錯誤', () => {
    expect(() => functionName(null)).toThrow('錯誤訊息');
  });
});
\`\`\`
```

**使用方式:**
```bash
claude /test src/utils/formatDate.ts
```

#### 範例 3: 文件生成指令

**`.claude/commands/docs.md`:**
```markdown
---
description: 生成 API 文件或函數說明
---

請為提供的程式碼生成完整的文件。

## 📚 文件要求

### JSDoc 格式
- 使用標準 JSDoc 語法
- 包含所有參數說明
- 包含回傳值說明
- 包含使用範例
- 註解使用**繁體中文**

### API 文件
- 端點 URL 和 HTTP 方法
- 請求參數和格式
- 回應格式和範例
- 錯誤碼說明
- 使用範例

### 範例格式

\`\`\`typescript
/**
 * 函數簡短描述
 *
 * @param paramName - 參數說明
 * @param optionalParam - 可選參數說明
 * @returns 回傳值說明
 * @throws {ErrorType} 錯誤說明
 *
 * @example
 * \`\`\`typescript
 * const result = functionName(param);
 * console.log(result);
 * \`\`\`
 */
\`\`\`
```

---

### 3. `.claude/prompts/` (Prompt 模板)

**用途:** 儲存常用的 Prompt 模板 (非官方功能,但實用)

#### 範例: 原型開發模式

**`.claude/prompts/prototype.md`:**
```markdown
# 快速原型開發模式

## 開發重���
- 🚀 快速實作功能
- 💡 專注核心邏輯
- ⏰ 時間優先於品質

## 允許的簡化
- ✅ 可使用 `any` 型別
- ✅ 可省略完整錯誤處理
- ✅ 可使用 console.log 除錯
- ✅ 可省略單元測試

## 仍需遵守
- ❗ 基本功能正確
- ❗ 主要邏輯清晰
- ❗ 避免明顯的安全漏洞

## 輸出要求
- 加入 TODO 註解標示需改進的地方
- 說明哪些部分需要後續完善
```

**使用方式:**
```bash
claude -p "建立使用者註冊功能" \
  --append-system-prompt "$(cat .claude/prompts/prototype.md)"
```

#### 範例: 生產環境模式

**`.claude/prompts/production.md`:**
```markdown
# 生產環境開發模式

## 品質要求
- ✅ 完整的型別定義
- ✅ 完善的錯誤處理
- ✅ 詳細的註解說明
- ✅ 單元測試覆蓋

## 安全要求
- 🔒 輸入驗證
- 🔒 輸出轉義
- 🔒 敏感資料加密
- 🔒 適當的權限檢查

## 效能要求
- ⚡ 優化演算法複雜度
- ⚡ 避免不必要的計算
- ⚡ 合理的快取策略

## 文件要求
- 📝 完整的 JSDoc
- 📝 使用範例
- 📝 錯誤處理說明
```

---

### 4. `~/.claude/CLAUDE.md` (全域 System Prompt)

**用途:** 為所有專案設定預設規範

**範例:**
```markdown
# 全域 Claude Code 設定

## 🌐 通用偏好

### 語言設定
- 所有回應使用**繁體中文**
- 程式碼註解使用**繁體中文**
- API 文件使用**英文** (國際化考量)

### 編碼風格
- 優先使用 **TypeScript**
- 使用**函數式程式設計**風格
- 包含**完整的錯誤處理**
- 遵循**業界最佳實踐**

### 安全性
- 永遠驗證使用者輸入
- 敏感資料必須加密
- 不在程式碼中硬編碼 secrets
- 實作適當的授權檢查

### 測試
- 所有功能包含單元測試
- 使用 AAA 模式組織測試
- 測試涵蓋邊界情況

## 📏 預設規範

這些規範適用於所有專案,除非專案的 `CLAUDE.md` 另有說明:

- 使用 2 空格縮排 (Python 除外,使用 4 空格)
- 字串使用單引號 (Python 除外)
- 每行最多 100 字元
- 函數式 > 物件導向
- 不可變資料結構

## 🚫 全域禁止
- ❌ 絕對不使用 `any` 型別
- ❌ 絕對不忽略錯誤
- ❌ 絕對不硬編碼敏感資訊
```

**階層載入順序:**
```
~/.claude/CLAUDE.md (全域,最低優先級)
    ↓ 合併
project/CLAUDE.md (專案層級)
    ↓ 合併
project/src/admin/CLAUDE.md (資料夾層級,最高優先級)
```

---

### 5. `~/.claude/settings.json` (全域 CLI 設定)

**用途:** CLI 工具的全域預設設定

**範例:**
```json
{
  "model": "claude-sonnet-4-5-20250929",
  "max_tokens": 4096,
  "temperature": 0.7,
  "system_prompt": "你是專業的程式設計助手,使用繁體中文回答所有問題",
  "default_include_patterns": [
    "*.ts",
    "*.tsx",
    "*.js",
    "*.jsx",
    "*.py",
    "*.md",
    "*.json"
  ],
  "default_exclude_patterns": [
    "node_modules/**",
    "dist/**",
    "build/**",
    "__pycache__/**",
    "*.log",
    ".git/**"
  ],
  "editor": "code",
  "auto_save": true,
  "confirm_before_edit": true
}
```

---

## 🎯 實際應用範例

### 範例 1: React 專案完整設定

```
my-react-app/
├── CLAUDE.md                          # 專案主要規範
├── .claude/
│   ├── settings.json                 # CLI 設定
│   ├── commands/
│   │   ├── component.md             # 快速建立元件
│   │   ├── test.md                  # 生成測試
│   │   └── storybook.md             # 生成 Storybook
│   └── prompts/
│       ├── feature.md               # 功能開發模式
│       └── bugfix.md                # Bug 修復模式
├── src/
│   ├── components/
│   └── pages/
└── .gitignore                        # 忽略 .claude/cache/
```

**`.claude/commands/component.md`:**
```markdown
---
description: 建立 React 元件和測試
---

請建立一個 React 元件,包含:

1. **元件檔案** (PascalCase.tsx)
   - TypeScript Function Component
   - Props interface 定義
   - 使用 Tailwind CSS

2. **測試檔案** (PascalCase.test.tsx)
   - 渲染測試
   - Props 測試
   - 互動測試

3. **index.ts** (具名匯出)

4. **Storybook** (PascalCase.stories.tsx)
   - 基本使用情境
   - 各種 Props 組合
```

**使用:**
```bash
# 建立 Button 元件
claude /component Button

# 輸出:
# - src/components/Button/Button.tsx
# - src/components/Button/Button.test.tsx
# - src/components/Button/Button.stories.tsx
# - src/components/Button/index.ts
```

---

### 範例 2: 全端專案設定

```
fullstack-app/
├── CLAUDE.md                          # 通用規範
├── .claude/
│   ├── settings.json
│   ├── commands/
│   │   ├── api.md                   # 建立 API 端點
│   │   ├── crud.md                  # 建立 CRUD
│   │   └── migration.md             # 資料庫遷移
│   └── prompts/
│       ├── frontend.md              # 前端開發
│       └── backend.md               # 後端開發
├── frontend/
│   └── CLAUDE.md                    # 前端特定規範
└── backend/
    └── CLAUDE.md                    # 後端特定規範
```

---

## ✅ 最佳實踐

### 1. 版本控制

**.gitignore 設定:**
```gitignore
# 忽略 CLI 快取和日誌
.claude/cache/
.claude/*.log

# 但保留設定檔和指令
!.claude/settings.json
!.claude/commands/
!.claude/prompts/
```

**建議加入 Git:**
- ✅ `.claude/settings.json` (專案配置)
- ✅ `.claude/commands/*.md` (自訂指令)
- ✅ `.claude/prompts/*.md` (Prompt 模板)
- ❌ `.claude/cache/` (快取目錄)
- ❌ `.claude/*.log` (日誌檔)

### 2. 團隊協作

**在 README.md 說明:**
```markdown
## 🤖 AI 輔助開發

### CLI 使用者
本專案包含自訂 Claude Code 指令:

\`\`\`bash
# 建立 React 元件
claude /component UserCard

# 程式碼審查
claude /review src/services/

# 生成測試
claude /test src/utils/formatDate.ts
\`\`\`

### VSCode 使用者
請使用專案的 `CLAUDE.md` 檔案,CLI 自訂指令不適用。
```

### 3. 指令命名規範

- 使用**動詞開頭**: `/review`, `/test`, `/generate`
- 保持**簡短明瞭**: `/comp` 而非 `/create-component`
- 按**功能分類**: `/api-create`, `/api-update`

---

## 🔑 關鍵要點

> **`.claude/` 目錄是 CLI 工具的進階功能,讓您建立可重複使用的指令和設定。VSCode 使用者主要使用 `CLAUDE.md`。**

記住:
- 📁 `.claude/` 主要為 CLI 工具
- 📝 `CLAUDE.md` 兩者都支援
- 🔧 `settings.json` 僅 CLI
- ⚡ 自訂指令僅 CLI
- 🤝 MCP/Subagents 配置在 CLI,VSCode 可使用

---

## 📚 延伸閱讀

- [2.4 VSCode vs CLI 差異](./2.4-vscode-vs-cli.md) - 詳細功能對照
- [5.1 動態調整 System Prompt](../chapter5/5.1-dynamic-adjustment.md) - Prompt 模板應用
- [附錄 C: 快速參考](../appendix/C-quick-reference.md) - CLI 指令速查

## 導航

- **上一節**: [2.4 VSCode 擴充套件 vs CLI 工具的差異](./2.4-vscode-vs-cli.md)
- **下一章**: [第三章: 資料夾層級設定](../chapter3/README.md)
- **返回**: [教材首頁](../../README.md)
