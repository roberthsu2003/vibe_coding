# 5.2 什麼時候用 CLI 版？

## 簡介

CLI（Command Line Interface）版本的 Claude Code 是專為命令列環境設計的工具，它在特定場景下展現出獨特的優勢。了解何時使用 CLI 版本，能讓你在開發工作中事半功倍。

本節將詳細說明 CLI 版本最適合的使用場景、優勢，以及實際應用範例。

## 理想使用場景

### 1. 自動化工作流程

CLI 版本最大的優勢在於可以無縫整合到各種自動化流程中。

**適用情境：**
```bash
# 自動化代碼生成
npm run generate && claude "優化生成的代碼"

# 整合到建構流程
npm run build && claude analyze dist/ --report build-quality.md

# Git hooks 整合
# .git/hooks/pre-commit
#!/bin/bash
claude analyze --staged --severity high
```

**實際案例：**
```bash
# 自動化每日維護腳本
#!/bin/bash
# daily-maintenance.sh

echo "📊 分析代碼品質..."
claude analyze ./src --format json > reports/quality-$(date +%Y%m%d).json

echo "📝 更新文檔..."
claude batch "更新所有過時的文檔註解"

echo "🧪 檢查測試覆蓋率..."
npm test -- --coverage

echo "✅ 每日維護完成！"
```

### 2. CI/CD 整合

在持續整合和部署流程中，CLI 版本是不可或缺的工具。

**GitHub Actions 範例：**
```yaml
# .github/workflows/code-quality.yml
name: Code Quality Check

on: [push, pull_request]

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Install Claude CLI
        run: npm install -g @anthropic-ai/claude-code

      - name: Analyze Code
        run: |
          claude analyze ./src --format json > analysis.json

      - name: Check for Critical Issues
        run: |
          claude "檢查 analysis.json，如果有 critical 級別的問題，列出並失敗"

      - name: Generate Report
        if: failure()
        run: claude "生成詳細的問題報告"
```

**GitLab CI 範例：**
```yaml
# .gitlab-ci.yml
code-quality:
  stage: test
  script:
    - npx @anthropic-ai/claude-code analyze ./src
    - npx @anthropic-ai/claude-code batch "為未測試的代碼生成測試"
  artifacts:
    reports:
      codequality: code-quality.json
```

### 3. 批次處理大量檔案

當需要處理數十或數百個檔案時，CLI 版本的批次處理能力無可匹敵。

**範例：大規模重構**
```bash
# 重構整個代碼庫
claude batch "將所有 var 改為 const/let" --pattern "src/**/*.js"

# 批次添加型別定義
find src -name "*.js" | while read file; do
  claude "為 $file 添加 TypeScript 型別定義" --auto-confirm
done

# 並行處理加速
claude batch --parallel 8 "優化所有元件" --pattern "src/components/**/*.tsx"
```

**範例：國際化導入**
```bash
#!/bin/bash
# i18n-migration.sh

# 步驟 1: 提取所有中文字串
claude batch "提取所有硬編碼的中文字串到 strings.json"

# 步驟 2: 生成 i18n 檔案
claude "根據 strings.json 生成 zh-TW.json"

# 步驟 3: 替換所有中文字串
claude batch "將中文字串替換為 t() 函數呼叫"

echo "✅ i18n 遷移完成！"
```

### 4. 遠端伺服器開發

在沒有圖形介面的遠端環境中，CLI 是唯一選擇。

**SSH 環境使用：**
```bash
# 連線到遠端伺服器
ssh user@production-server

# 在伺服器上使用 Claude CLI
claude "分析這個日誌檔案，找出錯誤原因" --input /var/log/app.log

# 快速修復問題
claude "修復 api.js 中的記憶體洩漏問題"

# 生成修復報告
claude "生成這次修復的詳細報告" > fix-report.md
```

**容器環境：**
```bash
# 在 Docker 容器內使用
docker exec -it my-container bash
claude analyze /app/src

# 或直接從主機執行
docker exec my-container claude "檢查應用健康狀態"
```

### 5. 快速一次性任務

對於快速的一次性任務，CLI 版本啟動快速、使用簡單。

**快速代碼片段：**
```bash
# 快速生成函數
claude "寫一個排序演算法" > sort.js

# 快速分析
claude "這段代碼有什麼問題？" --input buggy-code.js

# 快速重構
claude "簡化這個函數" --input complex-function.js --output simplified.js
```

**臨時腳本：**
```bash
# 生成資料處理腳本
claude "寫一個腳本，讀取 CSV 並轉換為 JSON" > convert.js
node convert.js input.csv > output.json
```

### 6. 腳本和工具開發

開發自己的開發工具時，CLI 版本可以作為基礎。

**自訂命令包裝：**
```bash
# my-dev-tool.sh
#!/bin/bash

function smart-commit() {
  # 分析變更
  changes=$(git diff --staged)

  # 讓 Claude 生成 commit message
  message=$(claude "根據這些變更生成 commit message" --input <(echo "$changes"))

  # 執行 commit
  git commit -m "$message"
}

function code-review() {
  # 自動 code review
  claude analyze $(git diff --name-only main) --format markdown > review.md
  echo "✅ Code review 報告已生成：review.md"
}
```

**整合到 npm scripts：**
```json
{
  "scripts": {
    "analyze": "claude analyze ./src",
    "test:generate": "claude batch '為未測試的檔案生成測試'",
    "docs:update": "claude batch '更新所有文檔註解'",
    "refactor": "claude batch '重構所有 legacy code'"
  }
}
```

### 7. 輕量級環境

在資源受限的環境中，CLI 版本的記憶體佔用更小。

**低配置機器：**
```bash
# CLI 只需要 ~50MB 記憶體
# VSCode + 擴充套件可能需要 > 500MB

# 在樹莓派或舊電腦上
claude analyze ./project
```

### 8. 排程任務

設定定期執行的維護任務。

**Cron 排程：**
```bash
# crontab -e

# 每天凌晨 2 點分析代碼品質
0 2 * * * cd /path/to/project && claude analyze ./src --report daily-report.md

# 每週一生成週報
0 9 * * 1 cd /path/to/project && claude "生成上週的代碼統計報告" > weekly-report.md

# 每小時檢查日誌
0 * * * * claude analyze /var/log/app.log --pattern "ERROR|CRITICAL"
```

## CLI 版本的優勢

### 速度優勢

| 操作 | CLI 版 | VSCode 版 |
|------|--------|-----------|
| 啟動時間 | < 1 秒 | ~5 秒 |
| 執行命令 | 立即 | 需要等待介面載入 |
| 批次處理 | 快速並行 | 逐個處理 |

### 自動化優勢

```bash
# CLI 可以完全自動化
#!/bin/bash
for repo in $(cat repos.txt); do
  git clone $repo
  cd $(basename $repo)
  claude analyze ./src
  cd ..
done

# VSCode 需要手動操作
```

### 整合優勢

```bash
# 與其他工具無縫整合
claude analyze ./src | jq '.issues[] | select(.severity == "high")'

# 管道處理
cat input.txt | claude "處理這些資料" | tee output.txt

# 組合多個工具
eslint src/ && claude "修復 ESLint 報告的問題" && npm test
```

## 實際工作流程範例

### 範例 1：完整的 PR 檢查流程

```bash
#!/bin/bash
# pr-check.sh

echo "🔍 檢查 PR..."

# 1. 代碼品質分析
echo "分析代碼品質..."
claude analyze $(git diff --name-only main) --severity medium

# 2. 檢查測試覆蓋率
echo "檢查測試..."
npm test -- --coverage
coverage=$(cat coverage/coverage-summary.json | jq '.total.lines.pct')

if (( $(echo "$coverage < 80" | bc -l) )); then
  echo "❌ 測試覆蓋率不足 80%"
  claude batch "為未測試的檔案生成測試"
fi

# 3. 生成 PR 描述
echo "生成 PR 描述..."
changes=$(git diff main...HEAD)
claude "根據這些變更生成 PR 描述" --input <(echo "$changes") > pr-description.md

echo "✅ PR 檢查完成！"
```

### 範例 2：自動化文檔維護

```bash
#!/bin/bash
# update-docs.sh

# 檢查哪些函數缺少文檔
missing_docs=$(claude "列出所有缺少文檔註解的函數" --format json)

# 批次添加文檔
claude batch "為所有缺少文檔的函數添加 JSDoc 註解"

# 生成 API 文檔
claude "根據代碼生成 API.md 文檔" > docs/API.md

# 更新 README
claude "更新 README，反映最新的功能變更"

# 提交變更
git add docs/ README.md src/
git commit -m "docs: update documentation"
```

### 範例 3：性能優化流程

```bash
#!/bin/bash
# optimize.sh

# 1. 分析效能瓶頸
claude "分析 src/performance-critical/ 下的效能問題"

# 2. 批次優化
claude batch "優化所有效能關鍵的函數" --pattern "src/performance-critical/**/*.js"

# 3. 運行基準測試
npm run benchmark

# 4. 生成優化報告
claude "比較優化前後的基準測試結果，生成報告" > optimization-report.md
```

## 不適合使用 CLI 的場景

雖然 CLI 很強大，但以下情況建議使用 VSCode 版：

1. **需要即時視覺化預覽** - VSCode 的分割視窗和 diff 檢視更直觀
2. **頻繁切換多個檔案** - VSCode 的檔案管理更方便
3. **團隊協作開發** - VSCode 的 Live Share 更適合
4. **教學或展示** - 圖形介面更容易理解
5. **不熟悉命令列** - 學習曲線較陡

## 選擇檢查清單

選擇 CLI 版本，如果你：

- [ ] 需要整合到自動化流程
- [ ] 經常處理大量檔案
- [ ] 在遠端或無圖形介面環境工作
- [ ] 需要設定定期任務
- [ ] 追求最快的執行速度
- [ ] 喜歡命令列工作方式
- [ ] 需要與其他命令列工具整合

## 常見問題

### Q: CLI 版本難學嗎？
A: 如果你熟悉命令列，很容易上手。基本用法很簡單，進階功能可以逐步學習。

### Q: 可以在 Windows 上使用嗎？
A: 可以！支援 PowerShell、CMD 和 WSL。

### Q: 需要一直連網嗎？
A: 是的，需要連線到 Claude API。

### Q: 可以離線使用嗎？
A: 目前不支援離線模式。

## 延伸閱讀

- [5.1 對照表格](./5.1-comparison-table.md) - 完整功能比較
- [5.3 什麼時候用 VSCode 版？](./5.3-when-to-use-vscode.md) - VSCode 版本的優勢
- [5.4 可以兩個都用嗎？](./5.4-using-both.md) - 組合使用策略

---

⏳ 內容持續補充中

## 導航

- **上一節**: [5.1 對照表格](./5.1-comparison-table.md)
- **下一節**: [5.3 什麼時候用 VSCode 版？](./5.3-when-to-use-vscode.md)
- **返回章節目錄**: [第五章目錄](./README.md)
- **返回首頁**: [教材首頁](../../README.md)
