# 5.4 可以兩個都用嗎？

## 簡介

好消息：你完全可以同時使用 CLI 版本和 VSCode 版本！事實上，這是許多進階開發者的選擇。兩個版本可以和平共存，甚至可以互補使用，讓你在不同場景下都能發揮最大效率。

本節將教你如何有效地結合使用兩個版本，建立最適合你的工作流程。

## 為什麼要兩個都用？

### 各取所長

```
日常開發
│
├─ VSCode 版
│  ├─ 寫代碼、除錯
│  ├─ 視覺化檢視
│  └─ 互動式探索
│
└─ CLI 版
   ├─ 批次處理
   ├─ 自動化腳本
   └─ CI/CD 整合
```

### 適用場景分工

| 場景 | 推薦版本 | 理由 |
|------|---------|------|
| 寫新功能 | VSCode | 即時預覽、整合工具 |
| 批次重構 | CLI | 效率高、可腳本化 |
| Code Review | VSCode | Diff 視圖清晰 |
| 自動化測試 | CLI | 整合 CI/CD |
| 學習新技術 | VSCode | 互動式、視覺化 |
| 維護腳本 | CLI | 快速、輕量 |
| 團隊協作 | VSCode | Live Share |
| 定期任務 | CLI | Cron 排程 |

## 同時安裝與設定

### 安裝兩個版本

```bash
# 1. 安裝 CLI 版本
npm install -g @anthropic-ai/claude-code

# 2. 在 VSCode 中安裝擴充套件
# Extensions → 搜尋 "Claude Code" → Install

# 3. 驗證安裝
claude --version
# 在 VSCode 中按 Cmd/Ctrl + Shift + P → "Claude: Version"
```

### 共享設定

兩個版本可以共享某些設定：

```bash
# 設定 API Key（兩個版本共用）
claude config set api-key YOUR_API_KEY

# 或使用環境變數
export CLAUDE_API_KEY=YOUR_API_KEY
```

**設定檔位置：**
```
~/.claude/
├── config.json       ← CLI 版主要設定
├── credentials       ← API 認證資訊（共用）
└── cache/           ← 快取（各自獨立）

~/.vscode/
└── extensions/
    └── claude-code/
        └── settings.json  ← VSCode 版設定
```

### 統一代碼風格設定

```json
// .claude/config.json（CLI 版）
{
  "style": "airbnb",
  "language": "typescript",
  "autoFormat": true
}
```

```json
// .vscode/settings.json（VSCode 版）
{
  "claude.codeStyle": "airbnb",
  "claude.defaultLanguage": "typescript",
  "claude.autoFormat": true
}
```

## 實用工作流程組合

### 工作流程 1：日常開發

**早上開始工作：**
```bash
# 1. CLI：快速檢查過夜的變更
claude analyze $(git diff --name-only origin/main)

# 2. CLI：運行自動化測試
npm test

# 3. 切換到 VSCode 開始寫代碼
code .
```

**開發中：**
- 在 VSCode 中開發新功能
- 使用 Claude 側邊欄互動
- 即時預覽和調整

**下班前：**
```bash
# CLI：批次處理遺留任務
claude batch "更新所有文檔註解"

# CLI：生成日報
claude "總結今天的代碼變更" > daily-report.md
```

### 工作流程 2：功能開發

```bash
# 階段 1：規劃（VSCode）
# 在 VSCode 中與 Claude 討論設計
# 視覺化檢視專案結構

# 階段 2：骨架生成（CLI - 快速）
claude "建立 feature/user-profile 的檔案結構" --output-dir src/features/user-profile

# 階段 3：實作細節（VSCode）
# 在 VSCode 中完善每個檔案
# 使用除錯工具測試

# 階段 4：測試生成（CLI - 批次）
claude batch "為 src/features/user-profile 下的所有檔案生成測試"

# 階段 5：文檔（CLI - 自動化）
claude batch "更新所有文檔和註解"

# 階段 6：Code Review（VSCode）
# 在 VSCode 中檢視所有變更
# 使用 Git 面板提交
```

### 工作流程 3：Bug 修復

```typescript
// 1. VSCode：定位問題
// 使用除錯器找到 bug 位置

// 2. VSCode：詢問 Claude
// 選取問題代碼，在側邊欄問：
// "這段代碼為什麼會導致記憶體洩漏？"

// 3. VSCode：修復
// 根據建議修改代碼

// 4. CLI：檢查影響範圍
claude analyze src/ --pattern "memory-leak"

// 5. CLI：批次修復相似問題
claude batch "修復所有類似的記憶體洩漏問題"

// 6. VSCode：驗證修復
// 運行測試和除錯驗證
```

### 工作流程 4：重構專案

```bash
# 第一階段：分析（CLI - 生成報告）
claude analyze ./src --comprehensive --output refactor-plan.md

# 第二階段：計劃（VSCode - 視覺化檢視）
# 在 VSCode 中閱讀 refactor-plan.md
# 與 Claude 討論重構策略

# 第三階段：執行（CLI - 批次處理）
# 批次重構類似的模式
claude batch "將所有 class 元件改為 functional 元件"

# 第四階段：微調（VSCode - 細節調整）
# 在 VSCode 中檢視每個變更
# 手動調整特殊情況

# 第五階段：驗證（CLI - 自動化測試）
npm test && npm run e2e

# 第六階段：提交（VSCode - Git 整合）
# 使用 VSCode 的 Git 面板分批提交
```

## 實際案例

### 案例 1：大型專案維護

**團隊成員 Alice 的一天：**

```bash
# 早上 9:00 - CLI：健康檢查
claude analyze ./src --report morning-check.md
npm test

# 9:30-12:00 - VSCode：開發新功能
# 在 VSCode 中實作用戶認證功能
# 使用 Claude 輔助生成代碼

# 12:00-13:00 - 午休

# 13:00-14:00 - CLI：批次處理
# 為所有新代碼生成測試
claude batch "為 src/auth 下的檔案生成測試"

# 14:00-17:00 - VSCode：Code Review 和調整
# 檢視團隊成員的 PR
# 在 VSCode 中進行 Code Review

# 17:00-17:30 - CLI：自動化任務
# 更新文檔
claude batch "更新所有 API 文檔"

# 生成日報
claude "總結今天的工作" > daily-summary.md
```

### 案例 2：緊急修復線上問題

```bash
# 1. CLI：快速分析日誌（SSH 連線到伺服器）
ssh production-server
claude analyze /var/log/app.log --pattern "ERROR"

# 2. CLI：識別問題
claude "分析這些錯誤日誌，找出根本原因" --input /var/log/app.log

# 3. 本機 VSCode：修復代碼
# 在本機 VSCode 中修改代碼
# 使用除錯器驗證修復

# 4. CLI：快速部署
git add .
git commit -m "hotfix: resolve memory leak"
git push

# 5. CLI：監控修復效果
claude "每 5 分鐘檢查一次錯誤日誌" --watch
```

### 案例 3：學習新技術

```bash
# 1. VSCode：互動式學習
# 在 Claude 側邊欄問：
# "教我 React Server Components，給我範例"

# 2. VSCode：實作範例
# 根據 Claude 的指導實作範例專案

# 3. CLI：生成練習專案
claude "建立 10 個練習專案，涵蓋 React Server Components 的不同用例"

# 4. VSCode：逐一練習
# 在 VSCode 中打開每個練習專案
# 邊做邊問 Claude

# 5. CLI：自動檢查
# 檢查練習是否正確
claude analyze practice-projects/ --check-best-practices
```

## 設定最佳實踐

### 1. 建立別名簡化操作

```bash
# ~/.bashrc 或 ~/.zshrc

# CLI 常用命令別名
alias ca='claude analyze'
alias cg='claude generate'
alias cr='claude refactor'
alias cb='claude batch'

# 組合命令
alias morning-check='claude analyze ./src && npm test'
alias update-docs='claude batch "更新所有文檔註解"'
alias code-review='claude analyze $(git diff --name-only main)'
```

### 2. VSCode 任務整合 CLI

```json
// .vscode/tasks.json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Claude: Analyze",
      "type": "shell",
      "command": "claude analyze ${file}",
      "group": "test"
    },
    {
      "label": "Claude: Generate Tests",
      "type": "shell",
      "command": "claude batch '為未測試的檔案生成測試'",
      "group": "test"
    },
    {
      "label": "Claude: Update Docs",
      "type": "shell",
      "command": "claude batch '更新所有文檔'",
      "group": "build"
    }
  ]
}
```

在 VSCode 中使用：`Cmd/Ctrl + Shift + P` → `Tasks: Run Task`

### 3. 整合到 Git Hooks

```bash
# .git/hooks/pre-commit
#!/bin/bash

echo "🔍 分析變更的檔案..."
claude analyze --staged

echo "📝 檢查文檔..."
claude "檢查 staged 檔案的文檔是否完整"

echo "✅ 檢查完成！"
```

## 避免衝突

### 不會衝突的操作

✅ **安全的同時使用：**
- 在 VSCode 中開發，同時 CLI 在背景分析
- VSCode 處理當前檔案，CLI 批次處理其他檔案
- 共享相同的 API key 和設定

### 可能衝突的操作

⚠️ **避免同時：**
- 兩個版本同時修改同一個檔案
- VSCode 有未儲存變更時，CLI 修改該檔案
- 兩個版本同時執行大規模批次處理

**解決方法：**
```bash
# 使用 Git 管理變更
git stash  # 暫存 VSCode 的變更
claude batch "批次處理"  # CLI 操作
git stash pop  # 恢復變更
```

## 成本考量

### API 使用

```bash
# 兩個版本共享 API quota
# 監控使用量
claude usage

# 設定限制
claude config set daily-limit 1000
```

### 最佳化使用

```
高成本操作（使用較多 tokens）：
├─ 大檔案分析
├─ 複雜重構
└─ 大量對話

低成本操作：
├─ 簡單生成
├─ 快速問答
└─ 代碼片段
```

**建議：**
- CLI 用於批次處理（一次 API 呼叫處理多個檔案）
- VSCode 用於互動式開發（較多小請求）

## 選擇策略總結

### 決策樹

```
任務類型？
│
├─ 互動式開發
│  └─ VSCode
│
├─ 批次處理
│  └─ CLI
│
├─ 自動化
│  └─ CLI
│
└─ 學習探索
   └─ VSCode
```

### 快速參考表

| 我想要... | 使用 |
|----------|------|
| 寫新功能 | VSCode |
| 批次重構 100+ 檔案 | CLI |
| 除錯問題 | VSCode |
| 設定 CI/CD | CLI |
| 學習新技術 | VSCode |
| 自動化定期任務 | CLI |
| Code Review | VSCode |
| 快速生成代碼片段 | 兩者都可以 |

## 常見問題

### Q: 兩個版本會互相干擾嗎？
A: 不會。它們可以和平共存，只要避免同時修改同一檔案。

### Q: 設定需要分別配置嗎？
A: API key 可以共用，但某些介面特定的設定需要分別配置。

### Q: 哪個版本更新比較快？
A: 通常同步更新，核心功能保持一致。

### Q: 可以在 VSCode 終端機中使用 CLI 嗎？
A: 可以！這是很常見的用法。

### Q: 成本會加倍嗎？
A: 不會，兩個版本共享 API quota。

## 延伸閱讀

- [5.1 對照表格](./5.1-comparison-table.md) - 完整功能比較
- [5.2 什麼時候用 CLI 版？](./5.2-when-to-use-cli.md) - CLI 優勢
- [5.3 什麼時候用 VSCode 版？](./5.3-when-to-use-vscode.md) - VSCode 優勢

---

⏳ 內容持續補充中

## 導航

- **上一節**: [5.3 什麼時候用 VSCode 版？](./5.3-when-to-use-vscode.md)
- **下一章**: [第六章：實戰練習](../chapter6/README.md)
- **返回章節目錄**: [第五章目錄](./README.md)
- **返回首頁**: [教材首頁](../../README.md)
