# 4.2 代碼分析 (analyze)

## 簡介

代碼分析功能讓 Claude 能夠深入理解你的程式碼，找出潛在問題、提供改進建議，並幫助你理解複雜的代碼邏輯。這就像有一位經驗豐富的資深工程師隨時在旁邊幫你做 Code Review。

無論是檢查代碼品質、找出效能瓶頸、識別安全漏洞，還是理解第三方程式碼，Claude 都能提供專業的分析和建議。

## 基本用法

### 分析單一檔案

```bash
# 分析檔案並給出建議
claude analyze src/utils/helper.js

# 分析特定函數
claude analyze src/api/user.js --function getUserById
```

### 分析整個專案

```bash
# 分析整個目錄
claude analyze ./src

# 分析特定模組
claude analyze ./src/components
```

## 分析類型

### 1. 代碼品質分析

```bash
# 檢查代碼品質
claude "分析 app.js 的代碼品質，找出可以改進的地方"

# 檢查是否符合最佳實踐
claude "檢查這個 React 元件是否符合 React 最佳實踐"
```

**分析內容包括：**
- 代碼可讀性
- 命名規範
- 函數複雜度
- 重複代碼
- 代碼組織結構

### 2. 效能分析

```bash
# 找出效能問題
claude "分析這個排序函數的時間複雜度"

# 優化建議
claude "找出這段代碼的效能瓶頸並提供優化建議"
```

**分析重點：**
- 演算法效率
- 記憶體使用
- 不必要的運算
- 資料庫查詢優化
- 前端渲染效能

### 3. 安全性分析

```bash
# 檢查安全漏洞
claude "檢查這個 API 端點是否有安全性問題"

# SQL 注入檢查
claude "分析這段資料庫查詢代碼，檢查是否有 SQL 注入風險"
```

**檢查項目：**
- 輸入驗證
- 認證授權
- 資料加密
- XSS 防護
- CSRF 防護

### 4. 相依性分析

```bash
# 分析模組相依關係
claude "分析這個專案的模組相依關係"

# 找出循環相依
claude "檢查是否有循環相依的問題"
```

### 5. 文檔完整性

```bash
# 檢查文檔註解
claude "檢查這個檔案的文檔註解是否完整"

# 建議需要補充的文檔
claude "列出這個 API 模組需要補充哪些文檔"
```

## 實用範例

### 範例 1：全面代碼審查

```bash
claude "請全面分析 user.controller.js，包括：
1. 代碼品質和可讀性
2. 是否有潛在的 bug
3. 效能問題
4. 安全性漏洞
5. 改進建議"
```

### 範例 2：理解複雜代碼

```bash
# 解釋代碼邏輯
claude "解釋 algorithm.js 中的 quickSort 函數是如何運作的"

# 繪製流程圖
claude "為這個訂單處理流程繪製流程圖"
```

### 範例 3：找出 Bug

```bash
# 除錯協助
claude "這個函數會回傳 undefined，幫我找出問題"

# 邏輯錯誤
claude "為什麼這個條件判斷沒有按預期工作？"
```

### 範例 4：比較不同實作

```bash
claude "比較這兩種實作方式，哪一種比較好？為什麼？
1. 使用 forEach 遍歷陣列
2. 使用 map 轉換陣列"
```

## 輸出格式

### 詳細報告

```bash
# 產生詳細分析報告
claude analyze ./src --output report.md --format detailed

# 包含建議的修改
claude analyze app.js --suggest-fixes
```

### JSON 格式

```bash
# 輸出 JSON 格式（方便整合到 CI/CD）
claude analyze ./src --format json > analysis.json
```

### 摘要模式

```bash
# 只顯示重要問題
claude analyze ./src --severity high

# 快速摘要
claude analyze app.js --format summary
```

## 互動式分析

```bash
claude

> 請分析 src/services/payment.js
> 特別注意交易安全性
> 有哪些潛在的風險？
> 建議如何改進？
```

## 整合到工作流程

### 1. Git Hook 整合

```bash
# 在 commit 前自動分析
# .git/hooks/pre-commit
#!/bin/bash
claude analyze --staged --severity high
```

### 2. CI/CD 整合

```yaml
# .github/workflows/code-analysis.yml
name: Code Analysis
on: [push, pull_request]
jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Analyze Code
        run: |
          npx @anthropic-ai/claude-code analyze ./src --format json
```

### 3. VS Code 整合

```bash
# 設定 VS Code 任務
{
  "label": "Claude Analyze",
  "type": "shell",
  "command": "claude analyze ${file}"
}
```

## 最佳實踐

### 1. 定期分析

```bash
# 每週進行全面分析
claude analyze ./src --comprehensive

# 追蹤改進進度
claude analyze ./src --compare-with last-week
```

### 2. 聚焦關鍵部分

```bash
# 優先分析核心模組
claude analyze ./src/core --priority high

# 分析最近修改的檔案
claude analyze $(git diff --name-only main)
```

### 3. 建立分析基準

```bash
# 建立初始基準
claude analyze ./src --baseline --save baseline.json

# 與基準比較
claude analyze ./src --compare baseline.json
```

## 分析指標

Claude 會根據以下指標評估代碼：

| 指標 | 說明 | 評分範圍 |
|------|------|---------|
| 可維護性 | 代碼易於理解和修改的程度 | 0-100 |
| 複雜度 | 循環複雜度 (Cyclomatic Complexity) | 1-50+ |
| 重複率 | 重複代碼的百分比 | 0-100% |
| 測試覆蓋率 | 測試涵蓋的代碼比例 | 0-100% |
| 文檔完整性 | 註解和文檔的完整程度 | 0-100 |

## 常見問題

### Q: 分析需要多久時間？
A: 取決於代碼量，通常單一檔案幾秒鐘，整個專案可能需要幾分鐘。

### Q: 會修改我的代碼嗎？
A: 不會，分析功能只讀取代碼並提供建議，不會做任何修改。

### Q: 可以自訂分析規則嗎？
A: 可以，使用配置檔定義自己的檢查規則和標準。

### Q: 支援哪些程式語言？
A: 支援所有主流語言，包括 JavaScript、Python、Java、Go、Rust 等。

## 小技巧

1. **漸進式改進**：不要一次修改所有問題，優先處理高嚴重度的
2. **學習機會**：把分析結果當作學習資源，理解為什麼某些做法更好
3. **團隊分享**：定期分享分析報告，提升團隊整體代碼品質
4. **自動化**：整合到 CI/CD，在問題進入主分支前就發現

## 延伸閱讀

- [4.3 代碼重構](./4.3-code-refactoring.md) - 根據分析結果進行重構
- [4.4 測試生成](./4.4-testing.md) - 提高測試覆蓋率
- [7.2 常見新手錯誤](../chapter7/7.2-common-mistakes.md) - 避免常見問題

---

⏳ 內容持續補充中

## 導航

- **上一節**: [4.1 代碼生成](./4.1-code-generation.md)
- **下一節**: [4.3 代碼重構](./4.3-code-refactoring.md)
- **返回章節目錄**: [第四章目錄](./README.md)
- **返回首頁**: [教材首頁](../../README.md)
